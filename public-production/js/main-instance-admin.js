//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

/*
 * Jeditable - jQuery in place edit plugin
 *
 * Copyright (c) 2006-2009 Mika Tuupola, Dylan Verheul
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/jeditable
 *
 * Based on editable by Dylan Verheul <dylan_at_dyve.net>:
 *    http://www.dyve.net/jquery/?editable
 *
 */

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

// Backbone.Marionette v0.8.4
//
// Copyright (C)2012 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT License
//
// Documentation and Full License Available at:
// http://github.com/derickbailey/backbone.marionette

/**
 * Backbone Forms v0.9.0
 *
 * NOTE:
 * This version is for use with RequireJS
 * If using regular <script> tags to include your files, use backbone-forms.min.js
 *
 * Copyright (c) 2012 Charles Davison, Pow Media Ltd
 *
 * License and more information at:
 * http://github.com/powmedia/backbone-forms
 */

/*!
 * fancyBox - jQuery Plugin
 * version: 2.0.6 (16/04/2012)
 * @requires jQuery v1.6 or later
 *
 * Examples at http://fancyapps.com/fancybox/
 * License: www.fancyapps.com/fancybox/#license
 *
 * Copyright 2012 Janis Skarnelis - janis@fancyapps.com
 *
 */

/*
 Copyright 2012 Igor Vaynberg

 Version: 3.2 Timestamp: Mon Sep 10 10:38:04 PDT 2012

 Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in
 compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software distributed under the License is
 distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and limitations under the License.
*/

/*!
 * jQuery UI @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */

/*!
 * jQuery UI Widget @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */

/*!
 * jQuery UI Position @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */

/*!
 * jQuery UI Autocomplete @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */

/*
 * jQuery UI Menu (not officially released)
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","jquery.mailcheck":"./libs/jquery.mailcheck.1.0.3.min","jquery.fancybox":"./libs/jquery.fancybox-2.0.6","jquery.jeditable":"./libs/jquery.jeditable-1.7.1","jquery.pulse":"./libs/jquery.pulse","jquery.select2":"./libs/jquery.select2-3.2",jqueryui:"./libs/jqueryui-1.8.22",underscore:"./libs/underscore-1.3.3-amd",Backbone:"./libs/backbone-0.9.2-amd","backbone-forms":"./libs/backbone-forms-0.9.0-amd","Backbone.Marionette":"./libs/backbone.marionette-0.8.4",text:"./libs/requirejs/text-1.0.8.min",order:"./libs/requirejs/order-1.0.5.min"}}),define("require-config",function(){}),define("jquery.mailcheck",["jquery"],function(e){(function(e){e.fn.mailcheck=function(e,n){var r="yahoo.com,google.com,hotmail.com,gmail.com,me.com,aol.com,mac.com,live.com,comcast.net,googlemail.com,msn.com,hotmail.co.uk,yahoo.co.uk,facebook.com,verizon.net,sbcglobal.net,att.net,gmx.com,mail.com".split(","),i="co.uk,com,net,org,info,edu,gov,mil".split(",");if("object"==typeof e&&void 0===n)e.domains=e.domains||r;else{var s=e,e=n;e.domains=s||r}e.topLevelDomains=e.topLevelDomains||i,e.distanceFunction=t.sift3Distance,(r=t.mailcheck.suggest(encodeURI(this.val()),e.domains,e.topLevelDomains,e.distanceFunction))?e.suggested&&e.suggested(this,r):e.empty&&e.empty(this)}})(e);var t={mailcheck:{threshold:3,suggest:function(e,t,n,r){e=e.toLowerCase(),e=this.splitEmail(e);if(t=this.findClosestDomain(e.domain,t,r)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(n=this.findClosestDomain(e.topLevelDomain,n),e.domain&&n&&n!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+n,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,n){var r,i=99,s=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var o=0;o<t.length;o++){if(e===t[o])return e;r=n(e,t[o]),r<i&&(i=r,s=t[o])}return i<=this.threshold&&null!==s?s:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,r=0,i=0,s=0;n+r<e.length&&n+i<t.length;){if(e.charAt(n+r)==t.charAt(n+i))s++;else for(var o=i=r=0;5>o;o++){if(n+o<e.length&&e.charAt(n+o)==t.charAt(n)){r=o;break}if(n+o<t.length&&e.charAt(n)==t.charAt(n+o)){i=o;break}}n++}return(e.length+t.length)/2-s},splitEmail:function(e){e=e.split("@");if(2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var n=e.pop(),r=n.split("."),i="";if(0==r.length)return!1;if(1==r.length)i=r[0];else{for(t=1;t<r.length;t++)i+=r[t]+".";2<=r.length&&(i=i.substring(0,i.length-1))}return{topLevelDomain:i,domain:n,address:e.join("@")}}}}}),require(["jquery","jquery.mailcheck"],function(e){var t=["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com","hotmail.co.uk","yahoo.co.uk","facebook.com","verizon.net","sbcglobal.net","att.net","gmx.com","mail.com","mysociety.org"];e(document).on("change","input[type=email]",function(){var n=e(this),r=n.next(".suggestion");r.length||(r=e('<div class="suggestion" />'),n.after(r).hide()),n.mailcheck({domains:t,suggested:function(e,t){var n="Did you mean <strong>"+t.full+"</strong>?";r.html(n).slideDown()},empty:function(e){r.slideUp()}})})}),define("augmenters/mailchecker",function(){}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}.call(this),require(["jquery","underscore"],function(e,t){e(function(){var n,r=function(){e.getJSON("/migration/progress/"+s,function(t){var r="Imported "+t.progress+" of "+t.total+" items.";t.total===t.progress&&t.count>=0&&(r='Finished importing <a href="/person" id="_finished">'+t.count+"</a> people.",e("#migration_completed_message").show(),clearInterval(n)),t.err&&t.err.name&&(r="An error occured: <br><pre>"+t.err.name+"\n\n"+t.err.err+"</pre>",e(".progress").addClass("error")),e(".progress").html(r)})};if(e(".progress").html()){var i=window.location.pathname.split("/"),s=i[i.length-1];n=window.setInterval(r,1e3)}e(".history-back").click(function(e){e.preventDefault(),window.history.back()}),e("form.migration-form select").change(function(){var t,n=e(this).parents("tr"),r=e(this).parents("td").next(),i=e(this).find(":selected"),s=i.filter("option[data-suggestions]").attr("data-suggestions"),o=n.attr("id"),u=i.attr("data-strict"),a=typeof u!="undefined"&&u;n.find("datalist").remove(),n.find("select[name=db-attribute]").remove(),n.find(".suggestions").html(""),r.find("input").show().attr("name","db-attribute");if(!s)return;var f=s.split(","),l="<select>";e.each(f,function(e,t){l+="<option>"+t+"</option>"}),l+="</select>";if(a)r.append(l).find("select").attr("name","db-attribute"),r.find("input").attr("name","").hide();else{var c='<datalist id="'+o+'"><select>'+l+"</select></datalist>";n.append(c),n.find("input[name=db-attribute]").attr("list",o),t=f.join(", "),n.find(".suggestions").html(t||"").append(",...")}}),e("form.migration-form").submit(function(){var n=t.zip(e("form.migration-form [name=db-attribute-class]").map(function(t,n){return e(n).val()}),e("form.migration-form [name=db-attribute]").map(function(t,n){return e(n).val()})),r=n.filter(function(e){return e[0]==="name"&&(e[1]==="First name"||e[1]==="Full name")});return r.length===0?(window.alert("You have to provide a column for 'First name'!"),!1):!0}),e("select").change()})}),define("augmenters/migration",function(){}),define("utils/slugify",[],function(){return function(e){return e.replace(/[^a-z0-9\-]+/gi,"-").replace(/-+/g,"-").replace(/-$/,"").replace(/^-/,"").toLowerCase()}}),require(["jquery","utils/slugify"],function(e,t){var n=function(t){return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||t===45||t===32||e.inArray(t,[13,37,39,9,20,46,8])>=0?!0:!1};e(document).on({keypress:function(e){var t=e.which||e.keyCode;return n(t)},change:function(n){var r=e(this).val(),i=t(r);e(this).val(i)}},"input[name=slug]")}),define("augmenters/slug-validation",function(){}),define("jquery.jeditable",["jquery"],function($){return $.fn.editable=function(e,t){if("disable"==e){$(this).data("disabled.editable",!0);return}if("enable"==e){$(this).data("disabled.editable",!1);return}if("destroy"==e){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var n=$.extend({},$.fn.editable.defaults,{target:e},t),r=$.editable.types[n.type].plugin||function(){},i=$.editable.types[n.type].submit||function(){},s=$.editable.types[n.type].buttons||$.editable.types.defaults.buttons,o=$.editable.types[n.type].content||$.editable.types.defaults.content,u=$.editable.types[n.type].element||$.editable.types.defaults.element,a=$.editable.types[n.type].reset||$.editable.types.defaults.reset,f=n.callback||function(){},l=n.onedit||function(){},c=n.onsubmit||function(){},h=n.onreset||function(){},p=n.onerror||a;return n.tooltip&&$(this).attr("title",n.tooltip),n.autowidth="auto"==n.width,n.autoheight="auto"==n.height,this.each(function(){var e=this,t=$(e).width(),d=$(e).height();$(this).data("event.editable",n.event),$.trim($(this).html())||$(this).html(n.placeholder),$(this).bind(n.event,function(h){if(!0===$(this).data("disabled.editable"))return;if(e.editing)return;if(!1===l.apply(this,[n,e]))return;h.preventDefault(),h.stopPropagation(),n.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(n.width=t,n.height=d):(n.width!="none"&&(n.width=n.autowidth?$(e).width():n.width),n.height!="none"&&(n.height=n.autoheight?$(e).height():n.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==n.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var v=$("<form />");n.cssclass&&("inherit"==n.cssclass?v.attr("class",$(e).attr("class")):v.attr("class",n.cssclass)),n.style&&("inherit"==n.style?(v.attr("style",$(e).attr("style")),v.css("display",$(e).css("display"))):v.attr("style",n.style));var m=u.apply(v,[n,e]),g;if(n.loadurl){var y=setTimeout(function(){m.disabled=!0,o.apply(v,[n.loadtext,n,e])},100),b={};b[n.id]=e.id,$.isFunction(n.loaddata)?$.extend(b,n.loaddata.apply(e,[e.revert,n])):$.extend(b,n.loaddata),$.ajax({type:n.loadtype,url:n.loadurl,data:b,async:!1,success:function(e){window.clearTimeout(y),g=e,m.disabled=!1}})}else n.data?(g=n.data,$.isFunction(n.data)&&(g=n.data.apply(e,[e.revert,n]))):g=e.revert;o.apply(v,[g,n,e]),m.attr("name",n.name),s.apply(v,[n,e]),$(e).append(v),r.apply(v,[n,e]),$(":input:visible:enabled:first",v).focus(),n.select&&m.select(),m.keydown(function(t){t.keyCode==27&&(t.preventDefault(),a.apply(v,[n,e]))});var y;"cancel"==n.onblur?m.blur(function(t){y=setTimeout(function(){a.apply(v,[n,e])},500)}):"submit"==n.onblur?m.blur(function(e){y=setTimeout(function(){v.submit()},200)}):$.isFunction(n.onblur)?m.blur(function(t){n.onblur.apply(e,[m.val(),n])}):m.blur(function(e){}),v.submit(function(t){y&&clearTimeout(y),t.preventDefault();if(!1!==c.apply(v,[n,e])&&!1!==i.apply(v,[n,e]))if($.isFunction(n.target)){var r=n.target.apply(e,[m.val(),n]);$(e).html(r),e.editing=!1,f.apply(e,[e.innerHTML,n]),$.trim($(e).html())||$(e).html(n.placeholder)}else{var s={};s[n.name]=m.val(),s[n.id]=e.id,$.isFunction(n.submitdata)?$.extend(s,n.submitdata.apply(e,[e.revert,n])):$.extend(s,n.submitdata),"PUT"==n.method&&(s._method="put"),$(e).html(n.indicator);var o={type:"POST",data:s,dataType:"html",url:n.target,success:function(t,r){o.dataType=="html"&&$(e).html(t),e.editing=!1,f.apply(e,[t,n]),$.trim($(e).html())||$(e).html(n.placeholder)},error:function(t,r,i){p.apply(v,[n,e,t])}};$.extend(o,n.ajaxoptions),$.ajax(o)}return $(e).attr("title",n.tooltip),!1})}),this.reset=function(t){this.editing&&!1!==h.apply(t,[n,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(n.placeholder),n.tooltip&&$(e).attr("title",n.tooltip))}})},$.editable={types:{defaults:{element:function(e,t){var n=$('<input type="hidden"></input>');return $(this).append(n),n},content:function(e,t,n){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var n=this;if(e.submit){if(e.submit.match(/>$/))var r=$(e.submit).click(function(){r.attr("type")!="submit"&&n.submit()});else{var r=$('<button type="submit" />');r.html(e.submit)}$(this).append(r)}if(e.cancel){if(e.cancel.match(/>$/))var i=$(e.cancel);else{var i=$('<button type="cancel" />');i.html(e.cancel)}$(this).append(i),$(i).click(function(r){if($.isFunction($.editable.types[e.type].reset))var i=$.editable.types[e.type].reset;else var i=$.editable.types.defaults.reset;return i.apply(n,[e,t]),!1})}}},text:{element:function(e,t){var n=$("<input />");return e.width!="none"&&n.width(e.width),e.height!="none"&&n.height(e.height),n.attr("autocomplete","off"),$(this).append(n),n}},textarea:{element:function(e,t){var n=$("<textarea />");return e.rows?n.attr("rows",e.rows):e.height!="none"&&n.height(e.height),e.cols?n.attr("cols",e.cols):e.width!="none"&&n.width(e.width),$(this).append(n),n}},select:{element:function(e,t){var n=$("<select />");return $(this).append(n),n},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json){if(!json.hasOwnProperty(key))continue;if("selected"==key)continue;var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){($(this).val()==json["selected"]||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}},!0}),require(["jquery","jquery.jeditable"],function(e){var t="/api/v1",n=function(n,r){var i=e(this),s=t+i.attr("data-api-url"),o=i.attr("data-api-name"),u={};return u[o]=n,e.ajax({url:s,type:"PUT",data:u,success:function(){},error:function(){window.alert("There was an error sending your changes to the server - please refresh the page and try again.")}}),n};e(function(){var t=e("body.signed_in");t.find(".edit-in-place").editable(n,{}),t.find(".edit-in-place-textarea").editable(n,{type:"textarea",submit:"OK",onblur:"ignore"}),t.find(".activate-edit-in-place").click(function(t){t.preventDefault();var n=e(this).attr("data-edit-in-place-id");e("#"+n).click()})})}),define("augmenters/edit-in-place",function(){}),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("Backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),function(e,t){if(typeof exports=="object"){var n=require("jquery"),r=require("underscore"),i=require("Backbone");module.exports=t(n,r,i)}else typeof define=="function"&&define.amd&&define("Backbone.Marionette",["jquery","underscore","Backbone"],t)}(this,function(e,t,n){return n.Marionette=function(e,t,n){var r={};r.version="0.8.4",r.View=e.View.extend({getTemplateSelector:function(){var e;return this.options&&this.options.template?e=this.options.template:e=this.template,t.isFunction(e)&&(e=e.call(this)),e},serializeData:function(){var e;return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e=this.mixinTemplateHelpers(e),e},mixinTemplateHelpers:function(e){e=e||{};var n=this.templateHelpers;return t.isFunction(n)&&(n=n.call(this)),t.extend(e,n)},configureTriggers:function(){if(!this.triggers)return;var e=this.triggers,n=this,r={};return t.isFunction(e)&&(e=e.call(this)),t.each(e,function(e,t){r[t]=function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),n.trigger(e)}}),r},delegateEvents:function(n){n=n||this.events,t.isFunction(n)&&(n=n.call(this));var r={},i=this.configureTriggers();t.extend(r,n,i),e.View.prototype.delegateEvents.call(this,r)},close:function(){this.beforeClose&&this.beforeClose(),this.unbindAll(),this.remove(),this.onClose&&this.onClose(),this.trigger("close"),this.unbind()}}),r.ItemView=r.View.extend({constructor:function(){var e=i.call(arguments);r.View.prototype.constructor.apply(this,e),t.bindAll(this,"render"),this.initialEvents()},initialEvents:function(){this.collection&&this.bindTo(this.collection,"reset",this.render,this)},render:function(){var e=this,t=n.Deferred(),r=function(){e.trigger("before:render",e),e.trigger("item:before:render",e);var t=e.serializeData();n.when(t).then(i)},i=function(t){var r=e.renderHtml(t);n.when(r).then(s)},s=function(t){e.$el.html(t),o(e.onRender,u,e)},u=function(){e.trigger("render",e),e.trigger("item:rendered",e),t.resolve()};return o(this.beforeRender,r,this),t.promise()},renderHtml:function(e){var t=this.getTemplateSelector();return r.Renderer.render(t,e)},close:function(){this.trigger("item:before:close"),r.View.prototype.close.apply(this,arguments),this.trigger("item:closed")}}),r.CollectionView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,arguments),t.bindAll(this,"addItemView","render"),this.initialEvents()},initialEvents:function(){this.collection&&(this.bindTo(this.collection,"add",this.addChildView,this),this.bindTo(this.collection,"remove",this.removeItemView,this),this.bindTo(this.collection,"reset",this.render,this))},addChildView:function(e){var t=this.getItemView();return this.addItemView(e,t)},render:function(){var e=this,t=n.Deferred(),r=[],i=this.getItemView();return this.beforeRender&&this.beforeRender(),this.trigger("collection:before:render",this),this.closeChildren(),this.collection&&this.collection.each(function(t){var n=e.addItemView(t,i);r.push(n)}),t.done(function(){this.onRender&&this.onRender(),this.trigger("collection:rendered",this)}),n.when.apply(this,r).then(function(){t.resolveWith(e)}),t.promise()},getItemView:function(){var e=this.options.itemView||this.itemView;if(!e){var t=new Error("An `itemView` must be specified");throw t.name="NoItemViewError",t}return e},addItemView:function(e,t){var r=this,s=this.buildItemView(e,t);this.bindTo(s,"all",function(){var e=i.call(arguments);e[0]="itemview:"+e[0],e.splice(1,0,s),r.trigger.apply(r,e)}),this.storeChild(s),this.trigger("item:added",s);var o=s.render();return n.when(o).then(function(){r.appendHtml(r,s)}),o},buildItemView:function(e,t){var n=new t({model:e});return n},removeItemView:function(e){var t=this.children[e.cid];t&&(t.close(),delete this.children[e.cid]),this.trigger("item:removed",t)},appendHtml:function(e,t){e.$el.append(t.el)},storeChild:function(e){this.children||(this.children={}),this.children[e.model.cid]=e},close:function(){this.trigger("collection:before:close"),this.closeChildren(),r.View.prototype.close.apply(this,arguments),this.trigger("collection:closed")},closeChildren:function(){this.children&&t.each(this.children,function(e){e.close()})}}),r.CompositeView=r.CollectionView.extend({constructor:function(e){r.CollectionView.apply(this,arguments),this.itemView=this.getItemView()},getItemView:function(){return this.itemView||this.constructor},render:function(){var e=this,t=n.Deferred(),r=this.renderModel();return n.when(r).then(function(r){e.$el.html(r),e.trigger("composite:model:rendered"),e.trigger("render");var i=e.renderCollection();n.when(i).then(function(){t.resolve()})}),t.done(function(){e.trigger("composite:rendered")}),t.promise()},renderCollection:function(){var e=r.CollectionView.prototype.render.apply(this,arguments);return e.done(function(){this.trigger("composite:collection:rendered")}),e.promise()},renderModel:function(){var e={};e=this.serializeData();var t=this.getTemplateSelector();return r.Renderer.render(t,e)}}),r.Region=function(e){this.options=e||{},t.extend(this,e);if(!this.el){var n=new Error("An 'el' must be specified");throw n.name="NoElError",n}this.initialize&&this.initialize.apply(this,arguments)},t.extend(r.Region.prototype,e.Events,{show:function(e,t){this.ensureEl(),this.close(),this.open(e,t),this.currentView=e},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return n(e)},open:function(e,t){var r=this;t=t||"html",n.when(e.render()).then(function(){r.$el[t](e.el),e.onShow&&e.onShow(),r.onShow&&r.onShow(e),e.trigger("show"),r.trigger("view:show",e)})},close:function(){var e=this.currentView;if(!e)return;e.close&&e.close(),this.trigger("view:closed",e),delete this.currentView},attachView:function(e){this.currentView=e}}),r.Layout=r.ItemView.extend({constructor:function(){this.vent=new e.Marionette.EventAggregator,e.Marionette.ItemView.apply(this,arguments),this.regionManagers={}},render:function(){return this.initializeRegions(),e.Marionette.ItemView.prototype.render.call(this,arguments)},close:function(){this.closeRegions(),e.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){var n=this;t.each(this.regions,function(t,r){var i=new e.Marionette.Region({el:t,getEl:function(e){return n.$(e)}});n.regionManagers[r]=i,n[r]=i})},closeRegions:function(){var e=this;t.each(this.regionManagers,function(t,n){t.close(),delete e[n]}),this.regionManagers={}}}),r.AppRouter=e.Router.extend({constructor:function(t){e.Router.prototype.constructor.call(this,t);if(this.appRoutes){var n=this.controller;t&&t.controller&&(n=t.controller),this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,n){var r,i,s,o,u,a=[],f=this;for(s in n)n.hasOwnProperty(s)&&a.unshift([s,n[s]]);o=a.length;for(u=0;u<o;u++){s=a[u][0],i=a[u][1],r=e[i];if(!r){var l="Method '"+i+"' was not found on the controller",c=new Error(l);throw c.name="NoMethodError",c}r=t.bind(r,e),f.route(s,i,r)}}}),r.Application=function(e){this.initCallbacks=new r.Callbacks,this.vent=new r.EventAggregator,t.extend(this,e)},t.extend(r.Application.prototype,e.Events,{addInitializer:function(e){this.initCallbacks.add(e)},start:function(e){this.trigger("initialize:before",e),this.initCallbacks.run(this,e),this.trigger("initialize:after",e),this.trigger("start",e)},addRegions:function(e){var t,n,i;for(i in e)e.hasOwnProperty(i)&&(t=e[i],typeof t=="string"?n=new r.Region({el:t}):n=new t,this[i]=n)}}),r.BindTo={bindTo:function(e,t,n,r){r=r||this,e.on(t,n,r),this.bindings||(this.bindings=[]);var i={obj:e,eventName:t,callback:n,context:r};return this.bindings.push(i),i},unbindFrom:function(e){e.obj.off(e.eventName,e.callback),this.bindings=t.reject(this.bindings,function(t){return t===e})},unbindAll:function(){var e=this,n=t.map(this.bindings,t.identity);t.each(n,function(t,n){e.unbindFrom(t)})}},r.Callbacks=function(){this.deferred=n.Deferred(),this.promise=this.deferred.promise()},t.extend(r.Callbacks.prototype,{add:function(e){this.promise.done(function(t,n){e.call(t,n)})},run:function(e,t){this.deferred.resolve(e,t)}}),r.EventAggregator=function(e){t.extend(this,e)},t.extend(r.EventAggregator.prototype,e.Events,r.BindTo,{bindTo:function(e,t,n){return r.BindTo.bindTo.call(this,this,e,t,n)}}),r.TemplateCache={templates:{},loaders:{},get:function(e){var t=this,r=n.Deferred(),i=this.templates[e];if(i)r.resolve(i);else{var s=this.loaders[e];s?r=s:(this.loaders[e]=r,this.loadTemplate(e,function(n){delete t.loaders[e],t.templates[e]=n,r.resolve(n)}))}return r.promise()},loadTemplate:function(e,t){var r=n(e).html();if(!r||r.length===0){var i="Could not find template: '"+e+"'",s=new Error(i);throw s.name="NoTemplateError",s}r=this.compileTemplate(r),t.call(this,r)},compileTemplate:function(e){return t.template(e)},clear:function(){var e,t=arguments.length;if(t>0)for(e=0;e<t;e++)delete this.templates[arguments[e]];else this.templates={}}},r.Renderer={render:function(e,t){var i=this,s=n.Deferred(),o=r.TemplateCache.get(e);return n.when(o).then(function(e){var n=i.renderTemplate(e,t);s.resolve(n)}),s.promise()},renderTemplate:function(e,t){var n=e(t);return n}},r.Modules={module:function(n,i){var s,o,u,a=this,f=this,n=n.split("."),l=n.length;for(var c=0;c<l;c++){var h=c===l-1;s=n[c],o=a[s],o||(o=new r.Application),h&&i&&(u=i(o,f,e,r,jQuery,t),u&&(o=u)),a[s]!==o&&(a[s]=o),a=o}return o}};var i=Array.prototype.slice,s=r.View.extend;r.Region.extend=s,r.Application.extend=s,r.Application.prototype.module=r.Modules.module,t.extend(r.View.prototype,r.BindTo),t.extend(r.Application.prototype,r.BindTo),t.extend(r.Region.prototype,r.BindTo);var o=function(e,t,r){var i;e&&(i=e.call(r)),n.when(i).then(t)};return r}(n,t,window.jQuery||window.Zepto||window.ender),n.Marionette}),define("instance-admin/app",["jquery","Backbone","Backbone.Marionette"],function(e,t,n){var r=new t.Marionette.Application;return r.on("start",function(t){e("body").addClass("instance-admin-app-active")}),r}),define("instance-admin/models/person",["Backbone"],function(e){var t=e.Model.extend({urlRoot:"/api/v1/person",schema:{name:{dataType:"Text",validators:["required"]},slug:{dataType:"Text",validators:["required"]}}});return t}),define("backbone-forms",["jquery","Backbone"],function(){var e=function(){return Backbone.View.extend({fields:null,initialize:function(e){this.schema=function(){if(e.schema)return e.schema;var t=e.model;if(!t)throw new Error("Could not find schema");return _.isFunction(t.schema)?t.schema():t.schema}(),this.model=e.model,this.data=e.data,this.fieldsToRender=e.fields||_.keys(this.schema),this.fieldsets=e.fieldsets,this.templateName=e.template||"form",this.fields={}},render:function(){var t=this,n=this.fieldsets,r=e.templates,i=$(r[this.templateName]({fieldsets:'<div class="bbf-placeholder"></div>'})),s=$(".bbf-placeholder",i);return n||(n=[{fields:this.fieldsToRender}]),_.each(n,function(e){_(e).isArray()&&(e={fields:e});var n=$(r.fieldset(_.extend({},e,{legend:e.legend?"<legend>"+e.legend+"</legend>":"",fields:'<div class="bbf-placeholder"></div>'}))),i=$(".bbf-placeholder",n);t.renderFields(e.fields,i),i=i.children().unwrap(),s.append(n)}),s.children().unwrap(),this.setElement(i),this},renderFields:function(t,n){var r=this,i=this.schema,s=this.model,o=this.data,u=this.fields,a=e.helpers.getNested;_.each(t,function(t){var f=function(){if(i[t])return i[t];var e=t.replace(/\./g,".subSchema.");return a(i,e)}();if(!f)throw"Field '"+t+"' not found in schema";var l={form:r,key:t,schema:f,idPrefix:r.options.idPrefix};s?l.model=s:o?l.value=o[t]:l.value=null;var c=new e.Field(l);f.type=="Hidden"?c.editor=helpers.createEditor("Hidden",l):n.append(c.render().el),u[t]=c})},validate:function(){var e=this,t=this.fields,n=this.model,r={};_.each(t,function(e){var t=e.validate();t&&(r[e.key]=t)});if(n&&n.validate){var i=n.validate(this.getValue());if(i){var s=_.isObject(i)&&!_.isArray(i);s||(r._others=r._others||[],r._others.push(i)),s&&_.each(i,function(t,n){if(e.fields[n]&&!r[n])e.fields[n].setError(t);else{r._others=r._others||[];var i={};i[n]=t,r._others.push(i)}})}}return _.isEmpty(r)?null:r},commit:function(){var e=this.validate();if(e)return e;var t;this.model.set(this.getValue(),{error:function(e,n){t=n}});if(t)return t},getValue:function(e){if(e)return this.fields[e].getValue();var t={};return _.each(this.fields,function(e){t[e.key]=e.getValue()}),t},setValue:function(e){for(var t in e)this.fields[t].setValue(e[t])},remove:function(){var e=this.fields;for(var t in e)e[t].remove();Backbone.View.prototype.remove.call(this)}})}(),t={form:'      <form class="bbf-form">{{fieldsets}}</form>    ',fieldset:"      <fieldset>        {{legend}}        <ul>{{fields}}</ul>      </fieldset>    ",field:'    <li class="bbf-field bbf-field{{type}}">      <label for="{{id}}">{{title}}</label>      <div class="bbf-editor bbf-editor{{type}}">{{editor}}</div>      <div class="bbf-help">{{help}}</div>    </li>    '},n={error:"bbf-error"};return e.helpers=function(){var t={};return t.getNested=function(e,t){var n=t.split("."),r=e;for(var i=0,s=n.length;i<s;i++)r=r[n[i]];return r},t.keyToTitle=function(e){return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()}),e},t.compileTemplate=function(e){var t=_.templateSettings.interpolate;_.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var n=_.template(e);return _.templateSettings.interpolate=t,n},t.createTemplate=function(e,n){var r=t.compileTemplate(e);return n?r(n):r},t.setTemplateCompiler=function(e){t.compileTemplate=e},t.setTemplates=function(n,r){var i=t.createTemplate;e.templates=e.templates||{},e.classNames=e.classNames||{},_.each(n,function(t,n,r){_.isString(t)&&(t=i(t)),e.templates[n]=t}),_.extend(e.classNames,r)},t.createEditor=function(t,n){var r;return _.isString(t)?r=e.editors[t]:r=t,new r(n)},t.triggerCancellableEvent=function(e,t,n,r){if(!e._callbacks||!e._callbacks[t])return r();var i=e._callbacks[t].next;if(!i)return r();var s=i.callback,o=i.context||this;n.push(r),s.apply(o,n)},t.getValidator=function(t){var n=e.validators;if(_.isRegExp(t))return n.regexp({regexp:t});if(_.isString(t)){if(!n[t])throw new Error('Validator "'+t+'" not found');return n[t]()}if(_.isFunction(t))return t;if(_.isObject(t)&&t.type){var r=t;return n[r.type](r)}throw new Error("Invalid validator: "+t)},t}(),e.validators=function(){var t={};return t.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:'Must match field "{{field}}"'},t.required=function(t){return t=_.extend({type:"required",message:this.errMessages.required},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return i}},t.regexp=function(t){if(!t.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return t=_.extend({type:"regexp",message:this.errMessages.regexp},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(!t.regexp.test(r))return i}},t.email=function(e){return e=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},e),t.regexp(e)},t.url=function(e){return e=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i},e),t.regexp(e)},t.match=function(t){if(!t.field)throw new Error('Missing required "field" options for "match" validator');return t=_.extend({type:"match",message:this.errMessages.match},t),function(r,i){t.value=r;var s={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(r!=i[t.field])return s}},t}(),e.Field=function(){var t=e.helpers,n=e.templates;return Backbone.View.extend({initialize:function(e){this.form=e.form,this.key=e.key,this.value=e.value,this.model=e.model;var n=this.schema=function(){return _.isString(e.schema)?{type:e.schema}:e.schema||{}}();n.type||(n.type="Text"),n.title||(n.title=t.keyToTitle(this.key)),n.template||(n.template="field")},render:function(){var n=this.schema,r=e.templates,i={form:this.form,key:this.key,schema:n,idPrefix:this.options.idPrefix,id:this.getId()};this.model?i.model=this.model:i.value=this.value;var s=this.editor=t.createEditor(n.type,i),o=$(r[n.template]({key:this.key,title:n.title,id:s.id,type:n.type,editor:'<span class="bbf-placeholder-editor"></span>',help:'<span class="bbf-placeholder-help"></span>'})),u=$(".bbf-placeholder-editor",o);return u.append(s.render().el),u.children().unwrap(),this.$help=$(".bbf-placeholder-help",o).parent(),this.$help.empty(),this.schema.help&&this.$help.html(this.schema.help),this.schema.fieldClass&&o.addClass(this.schema.fieldClass),this.schema.fieldAttrs&&o.attr(this.schema.fieldAttrs),this.setElement(o),this},getId:function(){var e=this.options.idPrefix,t=this.key;return t=t.replace(/\./g,"_"),_.isString(e)||_.isNumber(e)?e+t:_.isNull(e)?t:this.model?this.model.cid+"_"+t:t},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(t){if(this.editor.hasNestedForm)return;var n=e.classNames.error;this.$el.addClass(n),this.$help&&this.$help.html(t)},clearError:function(){var t=e.classNames.error;this.$el.removeClass(t);if(this.$help){this.$help.empty();var n=this.schema.help;n&&this.$help.html(n)}},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},logValue:function(){if(!console||!console.log)return;console.log(this.getValue())},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)}})}(),e.editors=function(){var t={};return t.Base=Backbone.View.extend({defaultValue:null,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw"Missing option: 'key'";this.model=e.model,this.key=e.key,this.value=this.model.get(this.key)}else e.value&&(this.value=e.value);this.value===undefined&&(this.value=this.defaultValue),this.form=e.form,this.schema=e.schema||{},this.validators=e.validators||this.schema.validators,this.$el.attr("name",this.getName()),this.schema.editorClass&&this.$el.addClass(this.schema.editorClass),this.schema.editorAttrs&&this.$el.attr(this.schema.editorAttrs)},getValue:function(){throw"Not implemented. Extend and override this method."},setValue:function(){throw"Not implemented. Extend and override this method."},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},commit:function(){var e=this.validate();if(e)return e;this.model.set(this.key,this.getValue(),{error:function(t,n){e=n}});if(e)return e},validate:function(){var t=this.$el,n=null,r=this.getValue(),i=this.form?this.form.getValue():{},s=this.validators,o=e.helpers.getValidator;return s&&_.each(s,function(e){n||(n=o(e)(r,i))}),n}}),t.Text=t.Base.extend({tagName:"input",defaultValue:"",initialize:function(e){t.Base.prototype.initialize.call(this,e);var n=this.schema,r="text";n&&n.editorAttrs&&n.editorAttrs.type&&(r=n.editorAttrs.type),n&&n.dataType&&(r=n.dataType),this.$el.attr("type",r)},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)}}),t.Number=t.Text.extend({defaultValue:0,events:{keypress:"onKeyPress"},initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","number")},onKeyPress:function(e){if(e.charCode==0)return;var t=this.$el.val()+String.fromCharCode(e.charCode),n=/^[0-9]*\.?[0-9]*?$/.test(t);n||e.preventDefault()},getValue:function(){var e=this.$el.val();return e===""?null:parseFloat(e,10)},setValue:function(e){e=e===null?null:parseFloat(e,10),t.Text.prototype.setValue.call(this,e)}}),t.Password=t.Text.extend({initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),t.TextArea=t.Text.extend({tagName:"textarea"}),t.Checkbox=t.Base.extend({defaultValue:!1,tagName:"input",initialize:function(e){t.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.attr("checked")?!0:!1},setValue:function(e){e&&this.$el.attr("checked",!0)}}),t.Hidden=t.Base.extend({defaultValue:"",initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},getValue:function(){return this.value},setValue:function(e){this.value=e}}),t.Select=t.Base.extend({tagName:"select",initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema||!this.schema.options)throw"Missing required 'schema.options'"},render:function(){var e=this.schema.options,t=this;if(e instanceof Backbone.Collection){var n=e;n.length>0?t.renderOptions(e):n.fetch({success:function(n){t.renderOptions(e)}})}else _.isFunction(e)?e(function(e){t.renderOptions(e)}):t.renderOptions(e);return this},renderOptions:function(e){var t=this.$el,n;_.isString(e)?n=e:_.isArray(e)?n=this._arrayToHtml(e):e instanceof Backbone.Collection&&(n=this._collectionToHtml(e)),t.html(n),this.setValue(this.value)},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_arrayToHtml:function(e){var t=[];return _.each(e,function(e){if(_.isObject(e)){var n=e.val?e.val:"";t.push('<option value="'+n+'">'+e.label+"</option>")}else t.push("<option>"+e+"</option>")}),t.join("")}}),t.Radio=t.Select.extend({tagName:"ul",className:"bbf-radio",getValue:function(){return this.$el.find("input[type=radio]:checked").val()},setValue:function(e){this.$el.find("input[type=radio][value="+e+"]").attr("checked",!0)},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="radio" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="radio" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Checkboxes=t.Select.extend({tagName:"ul",className:"bbf-checkboxes",getValue:function(){var e=[];return this.$el.find("input[type=checkbox]:checked").each(function(){e.push($(this).val())}),e},setValue:function(e){var t=this;_.each(e,function(e){t.$el.find('input[type=checkbox][value="'+e+'"]').attr("checked",!0)})},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="checkbox" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="checkbox" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Object=t.Base.extend({hasNestedForm:!0,className:"bbf-object",defaultValue:{},initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema.subSchema)throw"Missing required 'schema.subSchema' option for Object editor"},render:function(){var t=this.$el,n=this.value||{},r=this.key,i=this.schema,s=i.subSchema;return this.form=new e({schema:s,data:n,idPrefix:this.id+"_"}),t.html(this.form.render().el),this},getValue:function(){return this.form.getValue()},setValue:function(e){this.value=e,this.render()},remove:function(){this.form.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){return this.form.validate()}}),t.NestedModel=t.Object.extend({initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!e.schema.model)throw'Missing required "schema.model" option for NestedModel editor'},render:function(){var t=this.value||{},n=this.key,r=this.schema.model,i=r.prototype.schema;return _.isFunction(i)&&(i=i()),this.form=new e({schema:i,model:new r(t),idPrefix:this.id+"_"}),this.$el.html(this.form.render().el),this},commit:function(){var e=this.form.commit();return e?(this.$el.addClass("error"),e):t.Object.prototype.commit.call(this)}}),t}(),e.setTemplates=e.helpers.setTemplates,e.setTemplateCompiler=e.helpers.setTemplateCompiler,e.setTemplates(t,n),e}),define("templates",["underscore"],function(_){var AMD=function(){};return AMD.render=function(e,t){var n=this,r=function(r,i){var s=_.extend({},t,i,{__parentTemplate:e});return n.render(r,s)},i=_.extend({},t,{render:r}),s=this.templates[e];if(!s){var o="Can't find template: '"+e+"'";throw t.__parentTemplate&&(o+=" (rendered in '"+t.__parentTemplate+"')"),new Error(o)}try{return s(i)}catch(u){throw new Error("Error rendering '"+e+"': "+u)}},AMD.templates={},AMD.templates["html_footer.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='  </div>\n  <footer id="footer">\n    <div>\n\n      <div id="sitemap">\n        <ul>\n            <li><a href="/about/">About Us</a></li>\n            <li><a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/docs">Documentation</a></li>\n            <li><a href="/person">People</a>, <a href="/organisation">Organisations</a></li>\n            <li><a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/info/about">About PopIt</a></li>\n            <li><a href="/api">API</a> / <a href="/info/data-import">Data Freedom</a></li>\n            <li><a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/info/self-hosting">Self Hosting</a></li>\n            <li><a href="/info/privacy">Terms &amp; Privacy Policy</a></li>\n        </ul>\n      </div>\n\n      <div id="about-mysociety">\n\n          <p>\n            This is a database hosted on \n            <a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'">PopIt</a>\n            - a new service from \n            <a href="http://www.mysociety.org" title="mySociety">mySociety</a>\n            that lowers the barrier to getting started with transparency projects. Development is ongoing and this is \n            <a href="http://en.wikipedia.org/wiki/Software_release_life_cycle#Alpha">lpha</a> code. Please feel free to \n            <a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+"/instances/new\">make your own instance</a>\n            , and join our \n            <a href=\"https://secure.mysociety.org/admin/lists/mailman/listinfo/components\">mailing list</a>\n            to let us know that you're interested in giving it a go. \n          </p>\n\n          <p> \n            The <a href='https://github.com/mysociety/popit'>code is available on Github</a>,\n            and we have a <a href='http://popit-dev.tumblr.com/'>dev blog</a> if you want frequent\n            updates and musings on the project's development.\n          </p>\n\n          <p>\n            Learn more at \n            <a href=\""+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/info/about" title="About PopIt">'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'</a>\n          </p>\n\n          <p>\n            <a href="http://www.mysociety.org", title="mySociety">\n              <img id="mysociety-logo" src="/img/mysociety-logo.png" />\n            </a>\n          </p>\n\n      </div>\n    </div>\n\n    <div class="copyright">&copy; 2012 mySociety.org - v'+((__t=config.popit_version)==null?"":_.escape(__t))+"</div>\n\n    ",__p+='\n    <br />\n    <span id="instance-app-activated" class="admin-options">admin on</span>\n\n  </footer>\n</body>\n\n</html>\n';return __p},AMD.templates["html_head.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='\n<!DOCTYPE html>\n\n<!--[if lt IE 7]>\n    <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-gb">\n<![endif]-->\n<!--[if IE 7]>\n    <html class="no-js lt-ie9 lt-ie8" lang="en-gb">\n<![endif]-->\n<!--[if IE 8]>\n    <html class="no-js lt-ie9" lang="en-gb">\n<![endif]-->\n<!--[if gt IE 8]>\n    <!-- -->\n    <html lang="en-gb" class="no-js">\n<![endif]-->\n\n<head>\n  <meta charset="UTF-8">\n  <!--\n    PopIt\n\n    A really easy way to store and share information about politicians or other\n    public figures brought to you by mySociety, a charitable project which\n    builds websites that give people simple, tangible benefits in the civic and\n    community, and teaches through demonstration, how to use the internet most\n    efficiently to improve lives. (http://www.mysociety.org/)\n  -->\n\n  <meta name="creator" content="http://www.mysociety.org/">\n  <meta http-equiv="imagetoolbar" content="false">\n  <meta name="description" content="'+((__t=description)==null?"":_.escape(__t))+'">\n\n  <title>'+((__t=title)==null?"":_.escape(__t))+'</title>\n\n  <link rel="stylesheet" href="/css/popit.css?v'+((__t=config.popit_version)==null?"":_.escape(__t))+'" type="text/css" media="screen, print" charset="utf-8">\n  <link rel="stylesheet" href="/css/print.css?v'+((__t=config.popit_version)==null?"":_.escape(__t))+'" type="text/css" media="print" charset="utf-8">\n\n  <meta name="viewport" content="width=device-width,initial-scale=1">\n\n  <script>var require = { urlArgs: \'v'+((__t=config.popit_version)==null?"":_.escape(__t))+'\' };</script>\n  <script src="/js/libs/require-1.0.8.js" data-main="/js/main-instance" type="text/javascript" charset="utf-8"></script>\n\n  ';if(user||guest)__p+='\n    <script type="text/javascript" charset="utf-8">\n      require([\'/js/main-instance-admin.js\']);      \n    </script>\n  ';__p+='\n\n</head>\n\n<body id="popit-'+((__t=popit?popit.instance_name():"no-site-found")==null?"":_.escape(__t))+'" class="'+((__t=user||guest?"signed_in":"")==null?"":_.escape(__t))+'">\n\n  ',config.show_dev_site_warning&&(__p+='\n  <div id="dev-site-warning">\n    <strong>WARNING!</strong>\n    This is a development site and data may be deleted at any time!\n    <a href="/_dev">(dev tools)</a>\n  </div>\n  '),__p+="\n\n  ";var flash_info=flash("info");__p+="\n  ",flash_info.length&&(__p+='\n    <div id="flash-info">\n      <a class="close" href="#">[x]</a>\n      <ul>\n          ',_.each(flash_info,function(e){__p+="\n            <li>"+((__t=e)==null?"":_.escape(__t))+"</li>\n          "}),__p+="\n        </ul>\n    </div>\n  "),__p+="\n\n  ";if(user||guest)__p+='\n    <noscript>\n      <div id="no-js-warning">\n        Please <a href="http://www.enable-javascript.com/" target="_blank">enable JavaScript</a>\n        - without it much of the admin on this website will not work.\n      </div>\n    </noscript>\n  ';__p+='\n\n  <header id="header">\n    <h1 class="logo">\n      <a href=\'/\'>\n        ',popit?__p+='\n          <span id="popit_instance_name">'+((__t=popit.pretty_name())==null?"":_.escape(__t))+"</span>\n        ":__p+="\n          PopIt\n        ",__p+='\n      </a>\n    </h1>\n\n    <div id="user_menu">\n      ',popit&&(__p+='\n        <ul>\n        \n          <li>\n            <img id="ajax-loader" style="display: none;" src="/img/ajax-loader.gif">\n          </li>\n        \n          ',user||guest?__p+='\n            <li id="signed_in">\n              Signed in as \n              <span class="username">'+((__t=guest?"a Guest":user.email)==null?"":_.escape(__t))+'</span>\n            </li>\n        \n            <li>\n              <a href="/logout">Sign Out</a>\n            </li>\n          ':(__p+='\n            <li id="sign_in">\n              Sign in using an\n              <a href="/login?redirect_to='+((__t=current_absolute_pathname)==null?"":_.escape(__t))+'" id="sign_in_as_existing_user">existing account</a>\n              ',popit.allow_guest_access()&&(__p+='\n                or as a\n                <a href="/login?as_guest=1&amp;redirect_to='+((__t=current_absolute_pathname)==null?"":_.escape(__t))+'" id="sign_in_as_guest">guest</a>\n              '),__p+="\n             </li>\n          "),__p+='\n        </ul>\n      \n        <ul>\n          <li><a href="/">Home</a></li>\n          <li><a href="/person">People</a></li>\n          <li><a href="/organisation">Organisations</a></li>\n          <li><a href="/about">About Us</a></li>\n        \n          <li>\n            <form id="header_search_form" action="/search" method="get">\n              <input id="header_search_box" type="search" placeholder="search..." name="q">\n            </form>\n          </li>\n        </ul>\n      \n        <ul>\n          <li>\n            <span id="instance_guest_status">\n              ',popit&&popit.allow_guest_access()?__p+="\n                Guest edits allowed\n              ":__p+="\n                Authorised edits only\n              ",__p+="\n            </span>\n            \n            ",user&&(__p+='\n              <a href="/about/edit">(change)</a>\n            '),__p+="\n          </li>\n        </ul>\n      "),__p+='\n\n    </div>\n    \n    <div class="tagline">\n      A public database of people and organisations, hosted on PopIt. \n      <br>\n      Available for easy browsing and re-use as structured data over a REST API.\n    </div>\n\n  </header>\n  \n  <div id="content">\n    '}return __p},AMD.templates["index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:popit.pretty_name(),description:"Welcome to "+popit.pretty_name()}))==null?"":__t)+"\n\n<h1>Welcome to "+((__t=popit.pretty_name())==null?"":_.escape(__t))+"</h1>\n\n<p>\n  This database currently contains "+((__t=person_count||"no")==null?"":_.escape(__t))+" "+((__t=person_count==1?"person":"people")==null?"":_.escape(__t))+" and "+((__t=organisation_count||"no")==null?"":_.escape(__t))+" "+((__t=organisation_count==1?"organisation":"organisations")==null?"":_.escape(__t))+'.\n</p> \n\n<div id="person-summary" class="homepage-summary-box">\n  <h2>People</h2>\n\n  <ul>\n    ',persons.length?(__p+="    \n      ",_.each(persons,function(e){__p+='\n        <li> \n          <a href="/person/'+((__t=e.slug)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+"</a>\n        </li>\n      "}),__p+="\n      ",person_count>summary_listing_count&&(__p+='\n        <li>\n          and \n          <a href="/person">'+((__t=person_count-summary_listing_count)==null?"":_.escape(__t))+" more</a>\n        </li>\n      "),__p+="\n    "):__p+='\n      <li>\n        There are no people in the database yet. \n        <br>\n        <span.admin-options>\n          <a class="new-person add" href="#"> \n            <strong>+ Add</strong> a new person\n          </a>\n        </span>\n      </li>\n    ',__p+='\n  </ul>\n\n  <p>\n    <a href="/person">Complete list ('+((__t=person_count)==null?"":_.escape(__t))+')</a>\n  </p>\n\n</div>\n\n  \n<div id="organisation-summary" class="homepage-summary-box">\n\n  <h2>Organisations</h2>\n\n  <ul>\n    ',organisations.length?(__p+="    \n      ",_.each(organisations,function(e){__p+='\n        <li> \n          <a href="/organisation/'+((__t=e.slug)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+"</a>\n        </li>\n      "}),__p+="\n      ",organisation_count>summary_listing_count&&(__p+='\n        <li>\n          and \n          <a href="/organisation">'+((__t=organisation_count-summary_listing_count)==null?"":_.escape(__t))+" more</a>\n        </li>  \n      "),__p+="\n    "):__p+='\n      <li>\n        There are no organisations in the database yet. \n        <br>\n        <span class="admin-options">\n          <a class="add new-organisation" href="#">\n            <strong>+ Add</strong> a new organisation\n          </a>\n        </span>\n      </li>\n    ',__p+='\n  </ul>\n  \n  <p>\n    <a href="/organisation">Complete list ('+((__t=organisation_count)==null?"":_.escape(__t))+')</a>\n  </p>\n\n</div>\n\n\n<div id="actions" class="homepage-summary-box">\n\n  <div class="info">\n    <p>\n      <a href=\''+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/info/about\'>Learn more about PopIt</a>\n      - the pre-alpha platform that hosts this database.\n    </p>\n  </div>\n  \n  <div class="info admin-options">\n    <a class="new-person add" href="#"> \n      <strong>+ Add</strong> a new person to the database.\n    </a>\n  </div>\n\n</div>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["login.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Login",description:""}))==null?"":__t)+'\n\n<div class="login-form">\n\n  ',as_guest?__p+='\n    <h1>Guest login</h1>\n    <p class="instructions">\n      <p>You are about to log in to this web site as a guest user, letting you anonymously add and edit content.</p>\n\n      <p>Please be nice - for this to work we\'re relying on the wisdom of the crowd and the kindness of strangers.</p>\n    </p>\n  ':(__p+='\n    <h1>Login</h1>\n    <p class="instructions">\n      Log back in to manage your PopIt site.       \n\n      ',popit.allow_guest_access()&&(__p+='\n        <p>You can also <a href="?as_guest=1">log in anonymously as a guest</a>.</p>\n      '),__p+="\n\n    </p>\n    \n  "),__p+="\n\n\n  ",errors.length&&(__p+='\n    <ul id="errors">\n      ',_.each(errors,function(e){__p+='\n        <li class="error">'+((__t=e)==null?"":_.escape(__t))+"</li>        \n      "}),__p+="\n    </ul>\n  "),__p+="\n\n  <form action='/login' method='post'>\n\n    ",as_guest?__p+='\n          \n      <input type=\'hidden\' name=\'as_guest\', value="1">\n\n      <p>\n        <input id="login" class="btn" type="submit" value="Login as Guest">\n      </p>\n\n    ':__p+="\n      <p>\n        <label for='email'> Email:</label>\n        <input id=\"email\" type='text' name='email', value=\""+((__t=email)==null?"":_.escape(__t))+'">\n      </p>\n      \n      <p>\n        <label for=\'password\'>Password:</label>\n        <input id="password" type=\'password\' name=\'password\'>\n      </p>\n      \n      <p>\n        <input id="login" class="btn" type="submit" value="Login">\n      </p>\n\n      <p>\n        (<a href=\'https://github.com/mysociety/popit/issues/17\'>Forgotten your details?</a>)\n      </p>\n    ',__p+="\n    \n  </form>\n\n</div>\n\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["search.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Search",description:""}))==null?"":__t)+"\n\n<h1>Search</h1>\n  \n",results.length?(__p+="\n  <p>The following results have been found:</p>\n\n  <ul>\n    ",_.each(results,function(e){__p+='\n      <li>\n        <a href="/person/'+((__t=e.slug)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+"</a>\n      </li>\n    "}),__p+="\n  </ul>\n  \n"):__p+="\n  <p>Sorry, no results.</p>\n",__p+="\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["welcome.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Welcome to "+popit.pretty_name(),description:""}))==null?"":__t)+'\n\n<h1>Welcome to your new site!</h1>\n\n<div class="info">\n\n  <p>A new PopIt site has been created for you - ready for you to start populating</p>\n  \n  ',__p+='\n  \n  <p>\n    You should now \n    <strong><a class="new-person" href="#">add your first person</a></strong>\n    or if you already have a list of people in a spreadsheet you can use the \n    <strong><a href=\'/migration\'>migration tool</a></strong>.\n  </p>\n\n</div>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n\n";return __p},AMD.templates["position/new.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="new-position">\n\n  <h2>Create a new position</h2>\n  \n  <form name="create-new-position">\n\n    <ul class="error" />\n    \n    <p class="title">\n      <label>Title</label>\n      <input name="title" style="width:100%;" />\n    </p>\n    \n    <p class="person">\n      <label>Person</label>\n      <input name="person" style="width:100%;" />\n    </p>\n\n    <p class="organisation">\n      <label>Organisation</label>\n      <input name="organisation" style="width:100%;" />\n    </p>\n\n    <p class="start-date">\n      <label>Start date</label>\n      <input name="start-date" style="width:100%;" />\n    </p>\n\n    <p class="end-date">\n      <label>End date</label>\n      <input name="end-date" style="width:100%;" />\n    </p>\n\n    <p>\n      <input type=\'submit\' value="Create new position" />\n    </p>\n  </form>\n</div>\n';return __p},AMD.templates["position/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:position.name,description:""}))==null?"":__t)+'\n\n<h1></h1>\n\n<article class="position">\n\n  <h1>'+((__t=position.title)==null?"":_.escape(__t))+"</h1>\n\n  ",position.person&&(__p+='\n    <section class="person">\n      <p>\n        Person:\n        <a href="'+((__t=position.person.slug_url)==null?"":_.escape(__t))+'">'+((__t=position.person.name)==null?"":_.escape(__t))+"</a>\n      </p>\n    </section>\n  "),__p+="\n\n  ",position.organisation&&(__p+='\n    <section class="organisation">\n      <p>\n        Organisation:\n        <a href="'+((__t=position.organisation.slug_url)==null?"":_.escape(__t))+'">'+((__t=position.organisation.name)==null?"":_.escape(__t))+"</a>\n      </p>\n    </section>\n  "),__p+="\n\n  <p>Start Date: "+((__t=position.start_date.formatted||"???")==null?"":_.escape(__t))+"</p>\n  <p>End Date:   "+((__t=position.end_date.formatted||"???")==null?"":_.escape(__t))+'</p>\n\n  <section class="to_be_added">\n    <p>\n      There is a\n      <a href="https://github.com/mysociety/popit/issues/183">github ticket</a>\n      to put more details on this page.\n    </p>\n  </section>\n  \n  <section class="raw-data">\n    <h2>Raw data</h2>\n    <p>\n      The details for this organisation are also available in\n      <a href="/api/v0.1/position/#{position.id}">JSON</a>.\n    </p>\n  </section>\n\n</article>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["person/compact_list.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",items.length?(__p+="\n  ",_.each(items,function(e){__p+='\n    <li>\n      <a href="'+((__t=e.meta.edit_url)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+" ("+((__t=e.slug)==null?"":_.escape(__t))+")</a>\n    </li>\n  "}),__p+="\n"):__p+="\n  <li>No matches</li>\n",__p+="\n";return __p},AMD.templates["person/index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"People",description:"A list of all the people."}))==null?"":__t)+'\n\n<h1>People</h1>\n\n<p class="admin-options">\n  <a class="new-person add" href="#"> \n    <strong>+ Add</strong>\n    a new person\n  </a>\n</p>\n\n',people.length?(__p+="\n  <ul>\n    ",_.each(people,function(e){__p+='\n      <li>\n        <a href="'+((__t=e.slug_url)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+"</a>\n      </li>\n    "}),__p+="\n  </ul>\n\n"):(__p+='\n  <div class="info">\n    ',user?__p+='\n      <h3> \n        There are no people in the system yet, you should probably \n        <a class="new-person add" href="#">\n          <strong>add one now</strong>!\n        </a>\n      </h3>\n      \n      <p>\n        You just need to provide their name, once you\'ve \n        created their page you can add more details.\n      </p>\n      \n      <p>\n        If you already have data in a spreadsheet or similar you can use the \n        <a href="/migration" id="migration_tool">migration tool</a>\n        to import it.\n      </p>\n    ':__p+="\n      No people have been entered yet.\n    ",__p+="\n  </div>\n"),__p+="\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["person/new.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="new-person">\n  <h1>Add a person</h1>\n  \n  <form name="create-new-person">\n\n    ',__p+='\n\n    <h2>Suggestions</h2>\n\n    <ul class="suggestions" />\n    \n    <input type=\'submit\' value="Create new person">\n  </form>\n</div>\n';return __p},AMD.templates["person/remove.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="remove-person">\n  <form name="remove-person" method="post">\n    <input type=\'submit\' value="Really delete \''+((__t=person.name)==null?"":_.escape(__t))+"'?\">\n  </form>\n</div>\n";return __p},AMD.templates["person/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:person.name,description:person.name+": "+(person.summary||"")}))==null?"":__t)+'\n\n<article class="entity person" itemscope itemtype="http://schema.org/Person">\n\n  <header class="entity-header-nav" id="person-'+((__t=person.slug)==null?"":_.escape(__t))+'">\n    <h1 class="current-entity edit-in-place"\n        id="entity-name-in-header"\n        title="'+((__t=person.name)==null?"":_.escape(__t))+'"\n        data-api-url="/person/'+((__t=person.id)==null?"":_.escape(__t))+'"\n        data-api-name="name"\n    >'+((__t=person.name)==null?"":_.escape(__t))+'</h1>\n  </header>\n    \n  <aside>\n    <ul class="photos">\n      ',person.images.length?(__p+="\n        ",_.each(person.images,function(e){__p+="\n          <li>\n            ",e.url?(__p+="\n              ",__p+='\n              <img src="'+((__t=e.url)==null?"":_.escape(__t))+'" width="280" />\n            '):__p+='\n              <img src="'+((__t=image_proxy(person.slug_url+"/images/"+e.id,"",280))==null?"":_.escape(__t))+'" />\n            ',__p+='\n\n            <p class="photo-source">\n              source:\n              <a href="#photographer-url">Photographer</a>\n              <abbr class="license" title="Creative Commons - By Attribution - Share Alike">CC-BY-SA</abbr>\n              <ul class="admin-options">\n                <li>\n                  <form method="post" action="'+((__t=person.slug_url)==null?"":_.escape(__t))+"/images/"+((__t=e.id)==null?"":_.escape(__t))+'/delete">\n                    <input type="submit" value="delete" style="width: 4em; display: inline">\n                    this photograph\n                  </form>\n                </li>\n              </ul>\n            </p>\n          </li>\n        '}),__p+="\n      "):__p+="\n        <li>\n          <img src='/img/person_placeholder.svg' width=\"280\" />\n        </li>\n      ",__p+='\n    </ul>\n    <ul class="admin-options">\n      <li>\n        <a class="add" href="'+((__t=person.slug_url)==null?"":_.escape(__t))+'/images/upload">\n          <strong>+ add</strong>\n          a photograph\n        </a>\n      </li>\n    </ul>\n  </aside>\n    \n  <ul class="admin-options">\n    <li>\n      <a class="delete delete-person" data-id="'+((__t=person.id)==null?"":_.escape(__t))+'" >\n        <strong>- delete</strong>\n        this person\n      </a>\n    </li>\n    \n    <li>\n      <a class="edit activate-edit-in-place" data-edit-in-place-id="entity-name-in-header" href="#">\n        <strong>^ edit</strong>\n        this person\'s name\n      </a>\n    </li>\n  </ul>\n  \n  \n  <section class="description" itemprop="description">\n                \n    <ul class="admin-options">\n      <li>\n        <a class="edit activate-edit-in-place" data-edit-in-place-id="entity-summary-text" href="#">\n          <strong>^ edit</strong>\n          this summary\n        </a>\n      </li>\n    </ul>\n    \n    <p\n      id="entity-summary-text"\n      class="edit-in-place-textarea"\n      data-api-url="/person/'+((__t=person.id)==null?"":_.escape(__t))+'"\n      data-api-name="summary"\n    >'+((__t=person.summary)==null?"":_.escape(__t))+'</p>\n  \n  </section>\n  \n  <section class="personal-details">\n\n    <h2>Dates etc</h2>\n\n    <ul class="detail-list">\n\n      <li class="personal_details-date_of_birth">\n        '+((__t=render("partial-date/view.html",{date:person.personal_details.date_of_birth,title:"Birthdate",data_path_prefix:"personal_details.date_of_birth",data_url_root:person.api_base_url,data_id:person.id}))==null?"":__t)+'\n      </li>\n\n      <li class="personal_details-date_of_death">\n        '+((__t=render("partial-date/view.html",{date:person.personal_details.date_of_death,title:"Deathdate",data_path_prefix:"personal_details.date_of_death",data_url_root:person.api_base_url,data_id:person.id}))==null?"":__t)+"\n      </li>\n\n    </ul>\n  </section>\n  \n  ",person.other_names.length&&(__p+='\n    <section class="personal-details">\n\n      <h2>Alternative names:</h2>\n\n      <dl>\n        ',_.each(person.other_names,function(e){__p+="\n          <dt>"+((__t=e.comment||"Alternative name")==null?"":_.escape(__t))+':</dt>\n          <dd itemprop="name">'+((__t=e.name)==null?"":_.escape(__t))+"</dd>\n        "}),__p+="\n      </dl>\n    </section>  \n\n  "),__p+='    \n\n  <section class="positions">\n\n    <h2>Jobs and positions held now or in the past:</h2>\n\n    <ul class="admin-options">\n      <li>\n        <span class="admin-options">\n          <a data-person-id="'+((__t=person.id)==null?"":_.escape(__t))+'" data-person-hide-field="1" class="add new-position">\n            <strong>+ add</strong>\n            a new position\n          </a>\n      </li>\n    </ul>\n    \n    <dl>\n      ',_.each(positions,function(e){__p+='\n        <dt><a href="/position/'+((__t=e.id)==null?"":_.escape(__t))+'">'+((__t=e.title)==null?"":_.escape(__t))+"</a>:</dt>\n        <dd>\n          ",e.organisation?__p+='\n            <a href="'+((__t=e.organisation.slug_url)==null?"":_.escape(__t))+'">'+((__t=e.organisation.name)==null?"":_.escape(__t))+"</a>\n          ":__p+="\n            unknown\n          ",__p+="\n          \n          ";if(e.start_date.formatted||e.end_date.formatted)__p+="\n            (\n            ",e.start_date.formatted&&(__p+="\n              from "+((__t=e.start_date.formatted)==null?"":_.escape(__t))+"              \n            "),__p+="\n            ",e.end_date.formatted&&(__p+="\n              to "+((__t=e.end_date.formatted)==null?"":_.escape(__t))+"              \n            "),__p+="\n            )\n          ";__p+="\n        </dd>\n      "}),__p+='\n    </dl>  \n  </section>\n  \n  <section class="contact-information">\n\n    <h2>Contact Information:</h2>\n\n    <ul class="detail-list">\n\n      ',_.each(person.contact_details,function(e){__p+="\n        <li>\n          "+((__t=render("contact/view.html",{item:e,api_url_root:person.api_url+"/contact_details/"}))==null?"":__t)+"\n        </li>\n      "}),__p+='\n\n      <li>\n        <span class="admin-options">\n          <a data-url-root="'+((__t=person.api_url+"/contact_details/")==null?"":_.escape(__t))+'" class="add contact-edit">\n            <strong>+ add</strong>\n            a new contact detail\n          </a>\n        </span>\n      </li>\n    </ul>\n  </section>            \n\n  <section class="links">\n\n    <h2>Links:</h2>\n\n    <ul class="detail-list">\n      ',_.each(person.links,function(e){__p+="\n        <li>\n          "+((__t=render("link/view.html",{item:e,api_url_root:person.api_url+"/links/"}))==null?"":__t)+"\n        </li>\n      "}),__p+='\n\n      <li>\n        <span class="admin-options">\n          <a data-url-root="'+((__t=person.api_url+"/links/")==null?"":_.escape(__t))+'" class="add link-edit">\n            <strong>+ add</strong>\n            a new link\n          </a>\n        </span>\n      </li>\n\n    </ul>\n\n  </section>\n\n\n  <section class="raw-data">\n    \n    <h2>Raw data</h2>\n    \n    <p>\n      The details for this person are also available in \n      <a href="/api/v0.1/person/'+((__t=person.id)==null?"":_.escape(__t))+'">JSON</a>.\n    </p>\n  </section>\n\n</article>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["partial-date/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="admin-options">\n  <a class="edit partial-date-edit"\n     data-start="'+((__t=date.start)==null?"":_.escape(__t))+'"\n     data-end="'+((__t=date.end)==null?"":_.escape(__t))+'"\n     data-path-prefix="'+((__t=data_path_prefix)==null?"":__t)+'"\n     data-url-root="'+((__t=data_url_root)==null?"":__t)+'"\n     data-id="'+((__t=data_id)==null?"":__t)+'"\n     data-title="'+((__t=title)==null?"":_.escape(__t))+'"\n  >\n    <strong>^ edit</strong>\n    this date\n  </a>\n</span>\n\n<div class="list-item-title">'+((__t=title)==null?"":_.escape(__t))+':</div>\n<div class="list-item-value">'+((__t=date.formatted||"??")==null?"":_.escape(__t))+"</div>\n";return __p},AMD.templates["organisation/index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Organisations",description:"A list of all the organisations."}))==null?"":__t)+'\n\n<h1>Organisations</h1>\n\n<p class="admin-options">\n  <a class="new-organisation add" href="#">\n    <strong>+ Add</strong>\n    a new organisation\n  </a>\n</p>\n\n\n',organisations.length?(__p+="\n  <ul>\n    ",_.each(organisations,function(e){__p+='\n      <li>\n        <a href="'+((__t=e.slug_url)==null?"":_.escape(__t))+'">'+((__t=e.name)==null?"":_.escape(__t))+"</a>\n      </li>                                                \n    "}),__p+="\n  </ul>\n\n"):(__p+='\n  <div class="info">\n    ',user?__p+='\n      <h3> \n        There are no organisations in the system yet, you should probably \n        <a class="new-organisation add" href="#">\n          <strong>add one now</strong>!\n        </a> \n        \n      </h3>\n      \n      <p>\n        You just need to provide their name, once you\'ve \n        created their page you can add more details.\n      </p>\n      \n      <p>\n        If you already have data in a spreadsheet or similar you can use the \n        <a href="/migration" id="migration_tool">migration tool</a>\n        to import it.\n      </p>\n    ':__p+="\n      No organisations have been entered yet.\n    ",__p+="\n  </div>\n"),__p+="\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["organisation/new.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="new-organisation">\n  <h1>Add a organisation</h1>\n  \n  <form name="create-new-organisation">\n\n    ',__p+='\n\n    <h2>Suggestions</h2>\n\n    <ul class="suggestions" />\n    \n    <input type=\'submit\' value="Create new organisation">\n  </form>\n</div>\n';return __p},AMD.templates["organisation/remove.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="remove-organisation">\n  <form name="remove-organisation" method="post">\n    <input type=\'submit\' value="Really delete \''+((__t=organisation.name)==null?"":_.escape(__t))+"'?\">\n  </form>\n</div>\n";return __p},AMD.templates["organisation/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:organisation.name,description:organisation.name+" "+(organisation.summary||"")}))==null?"":__t)+'\n\n\n\n<article class="entity organisation">\n\n  <header class="entity-header-nav" id="organisation-'+((__t=organisation.slug)==null?"":_.escape(__t))+'">\n    <h1 class="edit-in-place current-entity"\n        id="entity-name-in-header"\n        title="'+((__t=organisation.name)==null?"":_.escape(__t))+'"\n        data-api-url="/organisation/'+((__t=organisation.id)==null?"":_.escape(__t))+'"\n        data-api-name="name"\n    >'+((__t=organisation.name)==null?"":_.escape(__t))+'</h1>\n  </header>\n  \n  <aside>\n\n    <ul class="photos">\n      ',organisation.images.length?(__p+="\n        ",_.each(organisation.images,function(e){__p+="\n          <li>\n            ",e.url?(__p+="\n              ",__p+='\n              <img src="'+((__t=e.url)==null?"":_.escape(__t))+'"  width="280" />\n            '):__p+='\n              <img src="'+((__t=image_proxy(organisation.slug_url+"/images/"+e.id,"",280))==null?"":_.escape(__t))+'" />\n            ',__p+='\n\n            <p class="photo-source">\n               source:\n              <a href="#photographer-url">Photographer</a>\n              <abbr class="license" title="Creative Commons - By Attribution - Share Alike">CC-BY-SA</abbr>\n              <ul class="admin-options">\n                <li>\n                  <form method="post" action="'+((__t=organisation.slug_url)==null?"":_.escape(__t))+"/images/"+((__t=e.id)==null?"":_.escape(__t))+'/delete">\n                    <input type="submit" value="delete" style="width: 4em; display: inline" />\n                    this photograph\n                  </form>\n                </li>\n              </ul>\n            </p>\n          </li>\n        '}),__p+="\n      "):__p+="\n        <li>\n          <img src='/img/organisation_placeholder.svg' width=\"280\" />            \n        </li>\n      ",__p+='\n    </ul>\n\n    <ul class="admin-options">\n      <li>\n        <a class="add" href="'+((__t=organisation.slug_url)==null?"":_.escape(__t))+'/images/upload">\n          <strong>+ add</strong>\n          a photograph\n        </a>\n      </li>\n    </ul>\n  </aside>\n    \n  <ul class="admin-options">\n    <li>\n      <a class="delete delete-organisation" data-id="'+((__t=organisation.id)==null?"":_.escape(__t))+'">\n        <strong>- delete</strong>\n        this organisation\n      </a>\n    </li>\n    \n    <li>\n      <a class="edit activate-edit-in-place" data-edit-in-place-id="entity-name-in-header" href="#">\n        <strong>^ edit</strong>\n        this organisation\'s name\n      </a>\n    </li>\n  </ul>\n\n  <section class="description" itemprop="description">\n                \n    <ul class="admin-options">\n      <li>\n        <a class="edit activate-edit-in-place" data-edit-in-place-id="entity-summary-text" href="#">\n          <strong>^ edit</strong>\n          this summary\n        </a>\n      </li>\n    </ul>\n\n    <p  id="entity-summary-text"\n        class="edit-in-place-textarea"\n        data-api-url="/organisation/'+((__t=organisation.id)==null?"":_.escape(__t))+'"\n        data-api-name="summary"\n    >'+((__t=organisation.summary)==null?"":_.escape(__t))+'</p>\n  \n  </section>\n\n  <section class="positions">\n  \n    <h2>Associated people, now or in the past:</h2>\n  \n    <ul class="admin-options">\n      <li>\n        <a  data-organisation-id="'+((__t=organisation.id)==null?"":_.escape(__t))+'"\n          data-organisation-hide-field="1"\n          class="add new-position">\n          <strong>+ add</strong>\n          a new position\n        </a>\n      </li>\n    </ul>\n\n    <dl>\n      ',_.each(positions,function(e){__p+='\n        <dt><a href="/position/'+((__t=e.id)==null?"":_.escape(__t))+'">'+((__t=e.title)==null?"":_.escape(__t))+"</a>:</dt>\n        <dd>\n          ",e.person?__p+='\n            <a href="'+((__t=e.person.slug_url)==null?"":_.escape(__t))+'" >'+((__t=e.person.name)==null?"":_.escape(__t))+"</a>\n          ":__p+="\n            unknown\n          ",__p+="\n        </dd>\n      "}),__p+='\n    </dl>    \n  </section>\n\n  \n  <section class="raw-data">\n    <h2>Raw data</h2>\n    <p>\n      The details for this organisation are also available in \n      <a href="/api/v0.1/organisation/'+((__t=organisation.id)==null?"":_.escape(__t))+'">JSON</a>.\n    </p>\n  </section>\n\n</article>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n\n";return __p},AMD.templates["migration/index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Migration Tool",description:""}))==null?"":__t)+'\n\n<h1>Migration Tool</h1>\n\n<p>\n  If you have been collecting information on people in a spreadsheet this\n  will let you quickly upload it all into PopIt rather than manually\n  entering it in. We expect that this will be in the form of a\n  <a href="http://en.wikipedia.org/wiki/Comma-separated_values" title="Wikipedia article on the CSV file format">CSV</a>\n  file.\n</p>\n\n<p>\n  The migration tool is intended to add data to PopIt, not to import data after the first import.\n</p>\n\n<p>\n  The migration process consists of 3 steps.\n</p>\n\n<ol>\n  <li>Upload a CSV file</li>\n  <li>Define the mapping</li>\n  <li>Wait for the import to happen</li>\n</ol>\n\n',migration.length&&(__p+='\n  <a href="/migration/clear">Clear previous migrations</a>\n  <ul>\n    ',_.each(migration,function(e){__p+='\n      <li>\n        <a href="/migration/mapping/'+((__t=e.id)==null?"":_.escape(__t))+'">\n          '+((__t=e.source.name)==null?"":_.escape(__t))+"\n          <small>("+((__t=e.created)==null?"":_.escape(__t))+")</small>\n         </a>\n       </li>\n     "}),__p+="\n  </ul>\n"),__p+='\n\n<form method="post" action="/migration/upload" enctype="multipart/form-data">\n  <div id="migration_source_file">\n    <label>Source file</label>\n    <input type="file" name="source">\n  </div>\n  <input type="submit" class="btn" value="Upload your CSV">\n</form>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"";return __p},AMD.templates["migration/mapping.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Migration Tool",description:""}))==null?"":__t)+'\n\n<h1 id="mapping">Define Mapping</h1>\n\n<p>\n  On this page you have to define the mapping for the import. Please read the instruction since this is the crucial step of the whole migration process. \n</p>\n\n<p>\n  A mapping is a way to tell the migration what the different column names mean. You should try to select a \n  <i>Database schema group</i>\n  and a \n  <i>Database Attribute</i>\n  for every column. \n</p>\n\n<p>\n  If you leave the \n  <i>Database schema group</i>\n  or the \n  <i>Database Attribute</i>\n  empty, it will not be imported.\n</p>\n\n',_.each(schemas,function(e,t){__p+="\n\n  <h2>"+((__t=e.name)==null?"":_.escape(__t))+'</h2>\n\n  <form method="post" action="" class="migration-form">\n    <input type="hidden" name="db-schema" value="'+((__t=t)==null?"":_.escape(__t))+'">\n\n    ';if(migration.source.parsed){__p+='\n      <table class="migration-table">\n        <thead>\n          <tr>\n            <th>Header from CSV</th>\n            <th>Database schema group</th>\n            <th>Database Attribute</th>\n            <th class="hidden">hidden</th>\n            <th>Example entries</th>\n          </tr>\n        </thead>\n        <tbody>\n          \n          ';var n=_.zip(migration.source.parsed.header,migration.source.parsed.data[1]||[],migration.source.parsed.data[2]||[]);__p+="\n          ",_.each(n,function(t,n){__p+='\n                      \n            <tr id="id_'+((__t=t[0].replace(/ /g,"_"))==null?"":_.escape(__t))+'">\n\n              <td>\n                <input type="hidden" name="csv-attribute" value="'+((__t=t[0])==null?"":_.escape(__t))+'">\n                '+((__t=t[0])==null?"":_.escape(__t))+'\n              </td>\n\n              <td>\n                <select name="db-attribute-class">\n                  <option value="" selected="selected">\n                  ',_.each(e.options,function(e,t){__p+='\n                    <option value="'+((__t=t)==null?"":_.escape(__t))+'" data-suggestions="'+((__t=e.suggestions.join(","))==null?"":_.escape(__t))+'" data-strict="'+((__t=e.strict?1:"")==null?"":_.escape(__t))+'">'+((__t=e.title)==null?"":_.escape(__t))+"</option>\n                  "}),__p+='\n              </td>\n              \n              <td>\n                <input type="text" name="db-attribute">\n                <small class=\'suggestions\' />\n              </td>\n              \n              <td class="hidden">                \n              </td>\n              \n              <td class="sample">\n                '+((__t=[t[1],t[2]].filter(function(e){return e}).join(", "))==null?"":_.escape(__t))+"\n              </td>\n            </tr>\n          "}),__p+='\n        </tbody>\n      </table>\n\n      <input type="submit" class="btn" value="Start migration">\n\n    '}__p+="\n\n  </form>\n"}),__p+="\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["migration/status.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Migration Tool",description:""}))==null?"":__t)+'\n\n<h1 id="status">Status of Migration</h1>\n\n',typeof people!="undefined"&&(__p+="\n  ",typeof error!="undefined"&&error?__p+='\n    <p class="note error">\n      Aww, something went wrong.\n      '+((__t=error)==null?"":_.escape(__t))+"\n    </p>\n  ":__p+='\n    <p class="note info">\n      Successfully migrated \n      <a href="/person">'+((__t=people.length)==null?"":_.escape(__t))+"\n      items.          \n    </p>\n  ",__p+="\n"),__p+='\n\n\n<p> \n  This page shows the status of the migration process. Go back to the \n  <a href="/migration">migration page</a>. In case of an error you can go     \n  <a href="#" class=\'history-back\'>back</a>.\n</p>\n\n<h2>Status</h2>\n\n',__p+='\n<p class="note progress">\n  ...migration starting...\n</p>\n\n\n',__p+='\n\n<div id="migration_completed_message" class="info" style="display: none">\n  <h3>Migration completed!</h3>\n  \n  <p>\n    <a href="/person">View results</a>\n  </p>\n  \n  <p>\n    Your import has now completed.\n  </p>\n  \n  <p> \n    You can now go and edit individuals to any add extra details that may not\n    have been in the data you uploaded.\n  </p>\n\n</div>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n     ";return __p},AMD.templates["link/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="admin-options">\n  <a data-id="'+((__t=item.id||item._id)==null?"":_.escape(__t))+'" data-url-root="'+((__t=api_url_root)==null?"":_.escape(__t))+'" class="edit link-edit">\n    <strong>^ edit</strong>\n  </a>\n</span>\n\n\n<div class="list-item-title">'+((__t=item.comment)==null?"":_.escape(__t))+': </div>\n<div class="list-item-value">'+((__t=item.url)==null?"":_.escape(__t))+"</div>\n";return __p},AMD.templates["info/data-import.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Data Import",description:"PopIt will let you enter and access data easily from your code. It will also let you upload existing data that you have to quickly populate a new site."}))==null?"":__t)+'\n\n<h1>Data Import</h1>\n\n<p>\n  PopIt will let you enter and access data easily from your code. It will \n  also let you upload existing data that you have to quickly populate a new \n  site.\n</p>\n\n\n<h2>Migration Tool</h2>\n\n<p> \n  If you have been collecting information on people in a spreadsheet this \n  web based tool will let you quickly upload it all into PopIt rather than \n  manually entering it in.\n</p>\n\n<p>\n  Go to the \n  a(href="/migration", id="migration_tool") migration tool\n   (which is currently a work in progress).\n\n\n<h2>API</h2>\n\n<p> \n  The API will let you access and modify all the data in PopIt, as well as \n  storing your own custom data. Please see the API docs on an existing PopIt \n  site for more details.\n</p>\n\n<p> \n  We use the API from the editing interface on the website to be sure that \n  all interactions with PopIt can be achieved through the API. It is not an \n  afterthought - it is a core piece of the site.\n</p>\n\n<p>\n  API improvements is an ongoing task with several <a href="https://github.com/mysociety/popit/issues?labels=API&amp;milestone=&amp;page=1&amp;state=open">open issues</a>. If you have particular suggestions or questions please let us know on the <a href="https://secure.mysociety.org/admin/lists/mailman/listinfo/components"> components mailing list</a>.\n</p>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["info/privacy.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Privacy",description:"Privacy policy, and terms and conditions"}))==null?"":__t)+'\n\n\n<h1>Privacy</h1>\n\n<p> \n  Privacy text goes here - see \n  <a href="https://github.com/mysociety/popit/issues/12">https://github.com/mysociety/popit/issues/12</a>\n</p>\n\n<h1>Terms and Conditions</h1>\n\n<p> \n  By uploading and ethering data to PopIt (except your private login \n  details) you consent for that data to be released under the\n  <a href="http://opendatacommons.org/licenses/odbl/">\n    Open Data Commons Open Database License (ODbL)\n  </a>. You will always be able to download all your data for re-use elsewhere, \n  including on local instances of PopIt.\n</p>\n\n<p>\n  We reserve the right to remove data or block accounts if the continued \n  functioning of the wider PopIt site is threatened, or if your use of the \n  site is clearly anti-social.\n</p>\n\n<p> \n  We will not share your private login details with anyone else, but the \n  data you author on the site will be public and world readable by default.\n</p>\n\n<p>\n  PopIt is a platform. mySociety does not pre-moderate content, and the \n  content does not belong to mySociety. Any concerns about bad data should \n  be initially directed at the person who owns and maintains the individual \n  PopIt site. If this is unsuccessful, then you can contact us at \n  hello@mysociety.org\n</p>\n\n<p>\n  As a UK registered charity mySociety cannot subsidise commercial companies \n  by providing them with free services. If you want to make use of PopIt for \n  commercial purposes, please mail commercial@mysociety.org to discuss the \n  options.\n</p>\n\n<p>\n  mySociety is keen for the data on PopIt instances to be up to date. To \n  that extent we reserve the right to post warnings that data is potentially \n  out of data on pages and in the API when we believe that it might be \n  misleading.\n</p>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["image/upload_image.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Upload image",description:""}))==null?"":__t)+'\n\n<h1>Upload an image</h1>\n\n<form action="" method="post" enctype="multipart/form-data">\n\n  <p>\n    <label for="image_upload">Image</label>\n    <input type="file" id="image_upload" name="image" />\n  </p>\n  \n  <p>\n    <label for="image_url">Or URL</label>\n    <input type="text" id="image_url" name="url" />\n\n    ',__p+='\n  </p>\n\n  <div>\n    <input type="submit" class="btn" value="Upload" />\n  </div>\n\n</form>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["errors/404.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Page not found",description:""}))==null?"":__t)+"\n\n<h1>Page not found</h1>\n\n<p>Please check your url and try again...</p>\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n\n";return __p},AMD.templates["errors/no_site_found.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Site not found",description:""}))==null?"":__t)+"\n\n<h1>Site not found</h1>\n\n<p>Please check your url and try again...</p>\n\n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["contact/view.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="admin-options">\n  <a data-id= '+((__t=item.id||item._id)==null?"":_.escape(__t))+" data-url-root="+((__t=api_url_root)==null?"":_.escape(__t))+' class="edit contact-edit">\n    <strong>^ edit</strong>\n  </a>\n</span>\n\n<div class="list-item-title">'+((__t=item.kind)==null?"":_.escape(__t))+':</div>\n<div class="list-item-value">'+((__t=item.value)==null?"":_.escape(__t))+"</div>\n";return __p},AMD.templates["api/index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"API",description:""}))==null?"":__t)+'\n\n\n<h1>API</h1>\n\n<p>The API allows you to easily access and edit all the data stored in PopIt from your code or other websites.</p>\n\n<p>Please see the <a href="'+((__t=config.hosting_site_base_url)==null?"":_.escape(__t))+'/docs/api">full API documentation</a>.</p>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["about/edit.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"Edit About Info",description:""}))==null?"":__t)+'\n\n<h1>Edit About Info</h1>\n\n<form method="post" action="" name="edit-about-info">\n\n  ',_.each(fields,function(e,t){__p+='\n    <div class="about-field">\n      <label>'+((__t=e.label)==null?"":_.escape(__t))+"</label>        \n      ",e.type=="textarea"?__p+='\n        <textarea name="'+((__t=t)==null?"":_.escape(__t))+'">'+((__t=e.value)==null?"":_.escape(__t))+"</textarea>\n      ":e.type=="checkbox"?(__p+='\n        <input\n          type="checkbox"\n          value="1"\n          name="'+((__t=t)==null?"":_.escape(__t))+'"\n          ',e.value&&(__p+='checked="checked"'),__p+="\n        />\n      "):__p+='\n        <input name="'+((__t=t)==null?"":_.escape(__t))+'" value="'+((__t=e.value)==null?"":_.escape(__t))+'">\n      ',__p+="\n    </div>\n    <br />\n  "}),__p+='\n\n  <input type="submit" class="btn" value="Update Info">\n\n</form>\n\n'+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD.templates["about/index.html"]=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+((__t=render("html_head.html",{title:"About Us",description:fields.summary}))==null?"":__t)+"\n\n<h1>\n  About Us\n  ",user&&(__p+='\n    <a href="/about/edit">(edit)</a>\n  '),__p+="\n</h1>\n\n",_.each(fields,function(e,t){__p+='\n  <div class="about-field about-field-'+((__t=e.key)==null?"":_.escape(__t))+'">\n    <b>'+((__t=e.label)==null?"":_.escape(__t))+":</b>\n    ",e.type=="checkbox"?__p+="\n      "+((__t=e.value?"Yes":"No")==null?"":_.escape(__t))+"\n    ":__p+="\n      "+((__t=e.value)==null?"":_.escape(__t))+"\n    ",__p+="\n  </div>\n  <br />\n"}),__p+="\n    \n"+((__t=render("html_footer.html"))==null?"":__t)+"\n";return __p},AMD}),define("instance-admin/views/submit-form-helper",["jquery","underscore"],function(e,t){return function(n){return n=n||{},function(r){r.preventDefault();var i=n.view||this,s=i.form,o=n.success_cb||function(e,t){document.location=t.meta.edit_url},u=function(n,r){var i=r.responseText;if(!i)return;var o=e.parseJSON(r.responseText).errors||{};t.each(o,function(e,t){s.fields[t]&&s.fields[t].setError(e)})},a=s.commit();t.isEmpty(a)&&(n.pre_save_cb&&n.pre_save_cb(),i.model.save({},{success:o,error:u}))}}}),define("instance-admin/collections/suggestions",["Backbone"],function(e){var t=e.Collection.extend({});return t}),define("instance-admin/views/suggestions",["Backbone","underscore","instance-admin/collections/suggestions","templates"],function(e,t,n,r){var i=e.View.extend({tagName:"ul",className:"suggestions",collection:new n,render:function(){var e=r.render("person/compact_list.html",{items:this.collection.toJSON()});return this.$el.html(e),this},setName:t.debounce(function(e){var t=this;return e?t.collection.fetch({data:{name:e},success:function(){t.render()}}):(t.collection.reset(),t.render()),t},200)});return i}),define("instance-admin/views/person-new",["jquery","Backbone","backbone-forms","underscore","utils/slugify","templates","instance-admin/models/person","instance-admin/views/submit-form-helper","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u,a){var f=t.View.extend({initialize:function(){this.form=new n({model:this.model,fields:["name","slug"]}),this.suggestionsView=new a,this.suggestionsView.collection.url="/api/v1/person"},render:function(){var t=e(s.render("person/new.html",{})),n=e(this.form.render().el);return t.find("form").prepend(n.children()),this.$el.html(t),this.$("ul.suggestions").html(this.suggestionsView.render().el),this},events:{"submit form ":"submitForm","keyup input[name=name]":"nameEdit"},submitForm:u(),nameEdit:function(e){var t=this.$(":input[name=name]"),n=this.$(":input[name=slug]");n.val(i(t.val()));var r=this;return r.suggestionsView.setName(t.val()),!0}});return f}),define("instance-admin/views/person-remove",["jquery","Backbone","backbone-forms","underscore","templates","instance-admin/models/person","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u){var a=t.View.extend({render:function(){return this.$el.html(i.render("person/remove.html",{person:this.model.toJSON()})),this},events:{"submit form":"submitForm"},submitForm:function(e){e.preventDefault(),this.model.destroy({success:function(e,t){document.location="/person"},error:function(e,t){window.alert("Something went wrong with the delete - please try again")}})}});return a}),define("jquery.fancybox",["jquery"],function(e){(function(e,t,n,r){var i=n(e),s=n(t),o=n.fancybox=function(){o.open.apply(this,arguments)},u=!1,a=null,f=t.createTouch!==r,l=function(e){return n.type(e)==="string"},c=function(e){return l(e)&&e.indexOf("%")>0},h=function(e,t){return t&&c(e)&&(e=o.getViewport()[t]/100*parseInt(e,10)),Math.round(e)+"px"};n.extend(o,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!f,autoCenter:!f,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!1,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(n.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:300,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:300,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){o.close(!0),e&&!n.isArray(e)&&(e=e instanceof n?n(e).get():[e]),o.isActive=!0,o.opts=n.extend(!0,{},o.defaults,t),n.isPlainObject(t)&&t.keys!==r&&(o.opts.keys=t.keys?n.extend({},o.defaults.keys,t.keys):!1),o.group=e,o._start(o.opts.index||0)},cancel:function(){if(o.coming&&!1===o.trigger("onCancel"))return;o.coming=null,o.hideLoading(),o.ajaxLoad&&o.ajaxLoad.abort(),o.ajaxLoad=null,o.imgPreload&&(o.imgPreload.onload=o.imgPreload.onabort=o.imgPreload.onerror=null)},close:function(e){o.cancel();if(!o.current||!1===o.trigger("beforeClose"))return;o.unbindEvents(),!o.isOpen||e&&e[0]===!0?(n(".fancybox-wrap").stop().trigger("onReset").remove(),o._afterZoomOut()):(o.isOpen=o.isOpened=!1,n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.closeMethod]())},play:function(e){var t=function(){clearTimeout(o.player.timer)},r=function(){t(),o.current&&o.player.isActive&&(o.player.timer=setTimeout(o.next,o.current.playSpeed))},i=function(){t(),n("body").unbind(".player"),o.player.isActive=!1,o.trigger("onPlayEnd")},s=function(){o.current&&(o.current.loop||o.current.index<o.group.length-1)&&(o.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":r,"onCancel.player beforeClose.player":i,"beforeLoad.player":t}),r(),o.trigger("onPlayStart"))};o.player.isActive||e&&e[0]===!1?i():s()},next:function(){o.current&&o.jumpto(o.current.index+1)},prev:function(){o.current&&o.jumpto(o.current.index-1)},jumpto:function(e){if(!o.current)return;e=parseInt(e,10),o.group.length>1&&o.current.loop&&(e>=o.group.length?e=0:e<0&&(e=o.group.length-1)),o.group[e]!==r&&(o.cancel(),o._start(e))},reposition:function(e,t){var n;o.isOpen&&(n=o._getPosition(t),e&&e.type==="scroll"?(delete n.position,o.wrap.stop(!0,!0).animate(n,200)):o.wrap.css(n))},update:function(e){if(!o.isOpen)return;u||(a=setTimeout(function(){var t=o.current,n=!e||e&&e.type==="orientationchange";if(u){u=!1;if(!t)return;if(!e||e.type!=="scroll"||n)t.autoSize&&t.type!=="iframe"&&(o.inner.height("auto"),t.height=o.inner.height()),(t.autoResize||n)&&o._setDimension(),t.canGrow&&t.type!=="iframe"&&o.inner.height("auto");(t.autoCenter||n)&&o.reposition(e),o.trigger("onUpdate")}},200)),u=!0},toggle:function(){o.isOpen&&(o.current.fitToView=!o.current.fitToView,o.update())},hideLoading:function(){s.unbind("keypress.fb"),n("#fancybox-loading").remove()},showLoading:function(){o.hideLoading(),s.bind("keypress.fb",function(e){e.keyCode===27&&(e.preventDefault(),o.cancel())}),n('<div id="fancybox-loading"><div></div></div>').click(o.cancel).appendTo("body")},getViewport:function(){return{x:i.scrollLeft(),y:i.scrollTop(),w:f&&e.innerWidth?e.innerWidth:i.width(),h:f&&e.innerHeight?e.innerHeight:i.height()}},unbindEvents:function(){o.wrap&&o.wrap.unbind(".fb"),s.unbind(".fb"),i.unbind(".fb")},bindEvents:function(){var e=o.current,t=e.keys;if(!e)return;i.bind("resize.fb orientationchange.fb"+(e.autoCenter&&!e.fixed?" scroll.fb":""),o.update),t&&s.bind("keydown.fb",function(e){var r,i=e.target||e.srcElement;!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(!i||!i.type&&!n(i).is("[contenteditable]"))&&(r=e.keyCode,n.inArray(r,t.close)>-1?(o.close(),e.preventDefault()):n.inArray(r,t.next)>-1?(o.next(),e.preventDefault()):n.inArray(r,t.prev)>-1&&(o.prev(),e.preventDefault()))}),n.fn.mousewheel&&e.mouseWheel&&o.group.length>1&&o.wrap.bind("mousewheel.fb",function(e,t){var n=e.target||null;t!==0&&(!n||n.clientHeight===0||n.scrollHeight===n.clientHeight&&n.scrollWidth===n.clientWidth)&&(e.preventDefault(),o[t>0?"prev":"next"]())})},trigger:function(e,t){var r,i=t||o[n.inArray(e,["onCancel","beforeLoad","afterLoad"])>-1?"coming":"current"];if(!i)return;n.isFunction(i[e])&&(r=i[e].apply(i,Array.prototype.slice.call(arguments,1)));if(r===!1)return!1;i.helpers&&n.each(i.helpers,function(t,r){r&&n.isPlainObject(o.helpers[t])&&n.isFunction(o.helpers[t][e])&&o.helpers[t][e](r,i)}),n.event.trigger(e+".fb")},isImage:function(e){return l(e)&&e.match(/\.(jpe?g|gif|png|bmp)((\?|#).*)?$/i)},isSWF:function(e){return l(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t={},r=o.group[e]||null,i,s,u,a,f;r&&(r.nodeType||r instanceof n)&&(i=!0,n.metadata&&(t=n(r).metadata())),t=n.extend(!0,{},o.opts,{index:e,element:r},n.isPlainObject(r)?r:t),n.each(["href","title","content","type"],function(e,s){t[s]=o.opts[s]||i&&n(r).attr(s)||t[s]||null}),typeof t.margin=="number"&&(t.margin=[t.margin,t.margin,t.margin,t.margin]),t.modal&&n.extend(!0,t,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),o.coming=t;if(!1===o.trigger("beforeLoad")){o.coming=null;return}u=t.type,s=t.href||r,u||(i&&(u=n(r).data("fancybox-type"),u||(a=r.className.match(/fancybox\.(\w+)/),u=a?a[1]:null)),!u&&l(s)&&(o.isImage(s)?u="image":o.isSWF(s)?u="swf":s.match(/^#/)&&(u="inline")),u||(u=i?"inline":"html"),t.type=u);if(u==="inline"||u==="html"){t.content||(u==="inline"?t.content=n(l(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):t.content=r);if(!t.content||!t.content.length)u=null}else s||(u=null);u==="ajax"&&l(s)&&(f=s.split(/\s+/,2),s=f.shift(),t.selector=f.shift()),t.href=s,t.group=o.group,t.isDom=i;switch(u){case"image":o._loadImage();break;case"ajax":o._loadAjax();break;case"inline":case"iframe":case"swf":case"html":o._afterLoad();break;default:o._error("type")}},_error:function(e){o.hideLoading(),n.extend(o.coming,{type:"html",autoSize:!0,minWidth:0,minHeight:0,padding:15,hasError:e,content:o.coming.tpl.error}),o._afterLoad()},_loadImage:function(){var e=o.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,o.coming.width=this.width,o.coming.height=this.height,o._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,o._error("image")},e.src=o.coming.href,(e.complete===r||!e.complete)&&o.showLoading()},_loadAjax:function(){o.showLoading(),o.ajaxLoad=n.ajax(n.extend({},o.coming.ajax,{url:o.coming.href,error:function(e,t){o.coming&&t!=="abort"?o._error("ajax",e):o.hideLoading()},success:function(e,t){t==="success"&&(o.coming.content=e,o._afterLoad())}}))},_preloadImages:function(){var e=o.group,t=o.current,r=e.length,i,s,u,a=Math.min(t.preload,r-1);if(!t.preload||e.length<2)return;for(u=1;u<=a;u+=1){i=e[(t.index+u)%r],s=i.href||n(i).attr("href")||i;if(i.type==="image"||o.isImage(s))(new Image).src=s}},_afterLoad:function(){o.hideLoading();if(!o.coming||!1===o.trigger("afterLoad",o.current)){o.coming=!1;return}o.isOpened?(n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.prevMethod]()):(n(".fancybox-wrap").stop().trigger("onReset").remove(),o.trigger("afterClose")),o.unbindEvents(),o.isOpen=!1,o.current=o.coming,o.wrap=n(o.current.tpl.wrap).addClass("fancybox-"+(f?"mobile":"desktop")+" fancybox-type-"+o.current.type+" fancybox-tmp "+o.current.wrapCSS).appendTo("body"),o.skin=n(".fancybox-skin",o.wrap).css("padding",h(o.current.padding)),o.outer=n(".fancybox-outer",o.wrap),o.inner=n(".fancybox-inner",o.wrap),o._setContent()},_setContent:function(){var e=o.current,t=e.content,r=e.type,i=e.minWidth,s=e.minHeight,u=e.maxWidth,a=e.maxHeight,l;switch(r){case"inline":case"ajax":case"html":e.selector?t=n("<div>").html(t).find(e.selector):t instanceof n&&(t.parent().hasClass("fancybox-inner")&&t.parents(".fancybox-wrap").unbind("onReset"),t=t.show().detach(),n(o.wrap).bind("onReset",function(){t.appendTo("body").hide()})),e.autoSize&&(l=n('<div class="fancybox-wrap '+o.current.wrapCSS+' fancybox-tmp"></div>').appendTo("body").css({minWidth:h(i,"w"),minHeight:h(s,"h"),maxWidth:h(u,"w"),maxHeight:h(a,"h")}).append(t),e.width=l.width(),e.height=l.height(),l.width(o.current.width),l.height()>e.height&&(l.width(e.width+1),e.width=l.width(),e.height=l.height()),t=l.contents().detach(),l.remove());break;case"image":t=e.tpl.image.replace("{href}",e.href),e.aspectRatio=!0;break;case"swf":t=e.tpl.swf.replace(/\{width\}/g,e.width).replace(/\{height\}/g,e.height).replace(/\{href\}/g,e.href);break;case"iframe":t=n(e.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",e.scrolling).attr("src",e.href),e.scrolling=f?"scroll":"auto"}if(r==="image"||r==="swf")e.autoSize=!1,e.scrolling="visible";r==="iframe"&&e.autoSize?(o.showLoading(),o._setDimension(),o.inner.css("overflow",e.scrolling),t.bind({onCancel:function(){n(this).unbind(),o._afterZoomOut()},load:function(){o.hideLoading();try{this.contentWindow.document.location&&(o.current.height=n(this).contents().find("body").height())}catch(e){o.current.autoSize=!1}o[o.isOpen?"_afterZoomIn":"_beforeShow"]()}}).appendTo(o.inner)):(o.inner.append(t),o._beforeShow())},_beforeShow:function(){o.coming=null,o.trigger("beforeShow"),o._setDimension(),o.wrap.hide().removeClass("fancybox-tmp"),o.bindEvents(),o._preloadImages(),o.transitions[o.isOpened?o.current.nextMethod:o.current.openMethod]()},_setDimension:function(){var e=o.wrap,t=o.inner,r=o.current,i=o.getViewport(),s=r.margin,u=r.padding*2,a=r.width,f=r.height,l=r.maxWidth+u,p=r.maxHeight+u,d=r.minWidth+u,v=r.minHeight+u,m,g;i.w-=s[1]+s[3],i.h-=s[0]+s[2],c(a)&&(a=(i.w-u)*parseFloat(a)/100),c(f)&&(f=(i.h-u)*parseFloat(f)/100),m=a/f,a+=u,f+=u,r.fitToView&&(l=Math.min(i.w,l),p=Math.min(i.h,p)),r.aspectRatio?(a>l&&(a=l,f=(a-u)/m+u),f>p&&(f=p,a=(f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u),f<v&&(f=v,a=(f-u)*m+u)):(a=Math.max(d,Math.min(a,l)),f=Math.max(v,Math.min(f,p))),a=Math.round(a),f=Math.round(f),n(e.add(t)).width("auto").height("auto"),t.width(a-u).height(f-u),e.width(a),g=e.height();if(a>l||g>p)while((a>l||g>p)&&a>d&&g>v)f-=10,r.aspectRatio?(a=Math.round((f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u)):a-=10,t.width(a-u).height(f-u),e.width(a),g=e.height();r.dim={width:h(a),height:h(g)},r.canGrow=r.autoSize&&f>v&&f<p,r.canShrink=!1,r.canExpand=!1,a-u<r.width||f-u<r.height?r.canExpand=!0:(a>i.w||g>i.h)&&a>d&&f>v&&(r.canShrink=!0),o.innerSpace=g-u-t.height()},_getPosition:function(e){var t=o.current,n=o.getViewport(),r=t.margin,i=o.wrap.width()+r[1]+r[3],s=o.wrap.height()+r[0]+r[2],u={position:"absolute",top:r[0]+n.y,left:r[3]+n.x};return t.autoCenter&&t.fixed&&!e&&s<=n.h&&i<=n.w&&(u={position:"fixed",top:r[0],left:r[3]}),u.top=h(Math.max(u.top,u.top+(n.h-s)*t.topRatio)),u.left=h(Math.max(u.left,u.left+(n.w-i)*.5)),u},_afterZoomIn:function(){var e=o.current,t=e?e.scrolling:"no";if(!e)return;o.isOpen=o.isOpened=!0,o.wrap.addClass("fancybox-opened"),o.inner.css("overflow",t==="yes"?"scroll":t==="no"?"hidden":t),o.trigger("afterShow"),o.update(),(e.closeClick||e.nextClick)&&o.inner.css("cursor","pointer").bind("click.fb",function(t){!n(t.target).is("a")&&!n(t.target).parent().is("a")&&o[e.closeClick?"close":"next"]()}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(o.skin).bind("click.fb",o.close),e.arrows&&o.group.length>1&&((e.loop||e.index>0)&&n(e.tpl.prev).appendTo(o.outer).bind("click.fb",o.prev),(e.loop||e.index<o.group.length-1)&&n(e.tpl.next).appendTo(o.outer).bind("click.fb",o.next)),o.opts.autoPlay&&!o.player.isActive&&(o.opts.autoPlay=!1,o.play())},_afterZoomOut:function(){var e=o.current;o.wrap.trigger("onReset").remove(),n.extend(o,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,skin:null,outer:null,inner:null}),o.trigger("afterClose",e)}}),o.transitions={getOrigPosition:function(){var e=o.current,t=e.element,r=e.padding,i=n(e.orig),s={},u=50,a=50,f;return!i.length&&e.isDom&&n(t).is(":visible")&&(i=n(t).find("img:first"),i.length||(i=n(t))),i.length?(s=i.offset(),i.is("img")&&(u=i.outerWidth(),a=i.outerHeight())):(f=o.getViewport(),s.top=f.y+(f.h-a)*.5,s.left=f.x+(f.w-u)*.5),s={top:h(s.top-r),left:h(s.left-r),width:h(u+r*2),height:h(a+r*2)},s},step:function(e,t){var n=t.prop,r,i;if(n==="width"||n==="height")r=Math.ceil(e-o.current.padding*2),n==="height"&&(i=(e-t.start)/(t.end-t.start),t.start>t.end&&(i=1-i),r-=o.innerSpace*i),o.inner[n](r)},zoomIn:function(){var e=o.wrap,t=o.current,r=t.openEffect,i=r==="elastic",s=t.dim,u=n.extend({},s,o._getPosition(i)),a=n.extend({opacity:1},u);delete a.position,i?(u=this.getOrigPosition(),t.openOpacity&&(u.opacity=0),o.outer.add(o.inner).width("auto").height("auto")):r==="fade"&&(u.opacity=0),e.css(u).show().animate(a,{duration:r==="none"?0:t.openSpeed,easing:t.openEasing,step:i?this.step:null,complete:o._afterZoomIn})},zoomOut:function(){var e=o.wrap,t=o.current,n=t.openEffect,r=n==="elastic",i={opacity:0};r&&(e.css("position")==="fixed"&&e.css(o._getPosition(!0)),i=this.getOrigPosition(),t.closeOpacity&&(i.opacity=0)),e.animate(i,{duration:n==="none"?0:t.closeSpeed,easing:t.closeEasing,step:r?this.step:null,complete:o._afterZoomOut})},changeIn:function(){var e=o.wrap,t=o.current,n=t.nextEffect,r=n==="elastic",i=o._getPosition(r),s={opacity:1};i.opacity=0,r&&(i.top=h(parseInt(i.top,10)-200),s.top="+=200px"),e.css(i).show().animate(s,{duration:n==="none"?0:t.nextSpeed,easing:t.nextEasing,complete:o._afterZoomIn})},changeOut:function(){var e=o.wrap,t=o.current,r=t.prevEffect,i={opacity:0},s=function(){n(this).trigger("onReset").remove()};e.removeClass("fancybox-opened"),r==="elastic"&&(i.top="+=200px"),e.animate(i,{duration:r==="none"?0:t.prevSpeed,easing:t.prevEasing,complete:s})}},o.helpers.overlay={overlay:null,update:function(){var e,r,o;this.overlay.width("100%").height("100%"),n.browser.msie||f?(r=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth),o=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),e=r<o?i.width():r):e=s.width(),this.overlay.width(e).height(s.height())},beforeShow:function(e){if(this.overlay)return;e=n.extend(!0,{},o.defaults.helpers.overlay,e),this.overlay=n('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),e.closeClick&&this.overlay.bind("click.fb",o.close),o.current.fixed&&!f?this.overlay.addClass("overlay-fixed"):(this.update(),this.onUpdate=function(){this.update()}),this.overlay.fadeTo(e.speedIn,e.opacity)},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,function(){n(this).remove()}),this.overlay=null}},o.helpers.title={beforeShow:function(e){var t,r=o.current.title;r&&(t=n('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+r+"</div>").appendTo("body"),e.type==="float"&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),o.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo(e.type==="over"?o.inner:e.type==="outside"?o.wrap:o.skin))}},n.fn.fancybox=function(e){var t=n(this),r=this.selector||"",i,u=function(s){var u=this,a=i,f,l;!(s.ctrlKey||s.altKey||s.shiftKey||s.metaKey)&&!n(u).is(".fancybox-wrap")&&(s.preventDefault(),f=e.groupAttr||"data-fancybox-group",l=n(u).attr(f),l||(f="rel",l=u[f]),l&&l!==""&&l!=="nofollow"&&(u=r.length?n(r):t,u=u.filter("["+f+'="'+l+'"]'),a=u.index(this)),e.index=a,o.open(u,e))};return e=e||{},i=e.index||0,r?s.undelegate(r,"click.fb-start").delegate(r,"click.fb-start",u):t.unbind("click.fb-start").bind("click.fb-start",u),this},n(t).ready(function(){o.defaults.fixed=n.support.fixedPosition||!(n.browser.msie&&n.browser.version<=6)&&!f})})(window,document,e)}),define("instance-admin/actions/person-add-remove",["jquery","instance-admin/app","instance-admin/models/person","instance-admin/views/person-new","instance-admin/views/person-remove","jquery.fancybox"],function(e,t,n,r,i){t.addInitializer(function(t){e("a.new-person").click(function(t){t.preventDefault();var i=new n({}),s=new r({model:i});e.fancybox(s.render().el),s.$(":input:first").focus()}),e("a.delete-person").click(function(t){var r=e(this);t.preventDefault();var s=new n({id:r.attr("data-id")});s.fetch({success:function(t,n){var r=new i({model:t});e.fancybox(r.render().el)}})})})}),define("instance-admin/models/organisation",["Backbone"],function(e){return e.Model.extend({urlRoot:"/api/v1/organisation",schema:{name:{dataType:"Text",validators:["required"]},slug:{dataType:"Text",validators:["required"]}}})}),define("instance-admin/views/organisation-new",["jquery","Backbone","backbone-forms","underscore","utils/slugify","templates","instance-admin/models/organisation","instance-admin/views/submit-form-helper","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u,a){var f=t.View.extend({initialize:function(){this.form=new n({model:this.model,fields:["name","slug"]}),this.suggestionsView=new a,this.suggestionsView.collection.url="/api/v1/organisation"},render:function(){var t=e(s.render("organisation/new.html",{})),n=e(this.form.render().el);return t.find("form").prepend(n.children()),this.$el.html(t),this.$("ul.suggestions").html(this.suggestionsView.render().el),this},events:{"submit form ":"submitForm","keyup input[name=name]":"nameEdit"},submitForm:u(),nameEdit:function(e){var t=this.$(":input[name=name]"),n=this.$(":input[name=slug]");n.val(i(t.val()));var r=this;return r.suggestionsView.setName(t.val()),!0}});return f}),define("instance-admin/views/organisation-remove",["jquery","Backbone","underscore","templates","instance-admin/models/organisation"],function(e,t,n,r,i){var s=t.View.extend({render:function(){return this.$el.html(r.render("organisation/remove.html",{organisation:this.model.toJSON()})),this},events:{"submit form":"submitForm"},submitForm:function(e){e.preventDefault(),this.model.destroy({success:function(e,t){document.location="/organisation"},error:function(e,t){window.alert("Something went wrong with the delete - please try again")}})}});return s}),define("instance-admin/actions/organisation-add-remove",["jquery","instance-admin/app","instance-admin/models/organisation","instance-admin/views/organisation-new","instance-admin/views/organisation-remove","jquery.fancybox"],function(e,t,n,r,i){t.addInitializer(function(t){e("a.new-organisation").click(function(t){t.preventDefault();var i=new n({}),s=new r({model:i});e.fancybox(s.render().el),s.$(":input:first").focus()}),e("a.delete-organisation").click(function(t){var r=e(this);t.preventDefault();var s=new n({id:r.attr("data-id")});s.fetch({success:function(t,n){var r=new i({model:t});e.fancybox(r.render().el)}})})})}),define("instance-admin/models/position",["Backbone"],function(e){return e.Model.extend({urlRoot:"/api/v1/position"})}),define("jquery.select2",["jquery"],function(e){return function(e){typeof e.fn.each2=="undefined"&&e.fn.extend({each2:function(t){var n=e([0]),r=-1,i=this.length;while(++r<i&&(n.context=n[0]=this[r])&&t.call(n[0],r,n)!==!1);return this}})}(e),function(e,t){function a(e,t){var n=0,r=t.length,i;if(typeof e=="undefined")return-1;if(e.constructor===String){for(;n<r;n+=1)if(e.localeCompare(t[n])===0)return n}else for(;n<r;n+=1){i=t[n];if(i.constructor===String){if(i.localeCompare(e)===0)return n}else if(i===e)return n}return-1}function f(e,n){return e===n?!0:e===t||n===t?!1:e===null||n===null?!1:e.constructor===String?e.localeCompare(n)===0:n.constructor===String?n.localeCompare(e)===0:!1}function l(t,n){var r,i,s;if(t===null||t.length<1)return[];r=t.split(n);for(i=0,s=r.length;i<s;i+=1)r[i]=e.trim(r[i]);return r}function c(e){return e.outerWidth()-e.width()}function h(n){var r="keyup-change-value";n.bind("keydown",function(){e.data(n,r)===t&&e.data(n,r,n.val())}),n.bind("keyup",function(){var i=e.data(n,r);i!==t&&n.val()!==i&&(e.removeData(n,r),n.trigger("keyup-change"))})}function p(n){n.bind("mousemove",function(n){var r=e.data(document,"select2-lastpos");(r===t||r.x!==n.pageX||r.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function d(e,n,r){r=r||t;var i;return function(){var t=arguments;window.clearTimeout(i),i=window.setTimeout(function(){n.apply(r,t)},e)}}function v(e){var t=!1,n;return function(){return t===!1&&(n=e(),t=!0),n}}function m(e,t){var n=d(e,function(e){t.trigger("scroll-debounced",e)});t.bind("scroll",function(e){a(e.target,t.get())>=0&&n(e)})}function g(e){e.preventDefault(),e.stopPropagation()}function y(t){if(!u){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);u=e("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),e("body").append(u)}return u.text(t.val()),u.width()}function b(e,t,n){var r=e.toUpperCase().indexOf(t.toUpperCase()),i=t.length;if(r<0){n.push(e);return}n.push(e.substring(0,r)),n.push("<span class='select2-match'>"),n.push(e.substring(r,r+i)),n.push("</span>"),n.push(e.substring(r+i,e.length))}function w(t){var n,r=0,i=null,s=t.quietMillis||100;return function(o){window.clearTimeout(n),n=window.setTimeout(function(){r+=1;var n=r,s=t.data,u=t.transport||e.ajax,a=t.traditional||!1,f=t.type||"GET";s=s.call(this,o.term,o.page,o.context),null!==i&&i.abort(),i=u.call(null,{url:t.url,dataType:t.dataType,data:s,type:f,traditional:a,success:function(e){if(n<r)return;var i=t.results(e,o.page);o.callback(i)}})},s)}}function E(t){var n=t,r,i=function(e){return""+e.text};return e.isArray(n)||(i=n.text,e.isFunction(i)||(r=n.text,i=function(e){return e[r]}),n=n.results),function(t){var r=t.term,s={results:[]},o;if(r===""){t.callback({results:n});return}o=function(n,s){var u,a;n=n[0];if(n.children){u={};for(a in n)n.hasOwnProperty(a)&&(u[a]=n[a]);u.children=[],e(n.children).each2(function(e,t){o(t,u.children)}),u.children.length&&s.push(u)}else t.matcher(r,i(n))&&s.push(n)},e(n).each2(function(e,t){o(t,s.results)}),t.callback(s)}}function S(n){return e.isFunction(n)?n:function(r){var i=r.term,s={results:[]};e(n).each(function(){var e=this.text!==t,n=e?this.text:this;(i===""||r.matcher(i,n))&&s.results.push(e?this:{id:this,text:this})}),r.callback(s)}}function x(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error("formatterName must be a function or a falsy value")}function T(t){return e.isFunction(t)?t():t}function N(t){var n=0;return e.each(t,function(e,t){t.children?n+=N(t.children):n++}),n}function C(e,n,r,i){var s=e,o=!1,u,a,l,c,h;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return t;for(;;){a=-1;for(l=0,c=i.tokenSeparators.length;l<c;l++){h=i.tokenSeparators[l],a=e.indexOf(h);if(a>=0)break}if(a<0)break;u=e.substring(0,a),e=e.substring(a+h.length);if(u.length>0){u=i.createSearchChoice(u,n);if(u!==t&&u!==null&&i.id(u)!==t&&i.id(u)!==null){o=!1;for(l=0,c=n.length;l<c;l++)if(f(i.id(u),i.id(n[l]))){o=!0;break}o||r(u)}}}if(s.localeCompare(e)!=0)return e}function k(t,n){var r=function(){};return r.prototype=new t,r.prototype.constructor=r,r.prototype.parent=t.prototype,r.prototype=e.extend(r.prototype,n),r}if(window.Select2!==t)return;var n,r,i,s,o,u;n={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){e=e.which?e.which:e;switch(e){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case n.SHIFT:case n.CTRL:case n.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123}},o=function(){var e=1;return function(){return e++}}(),e(document).delegate("body","mousemove",function(t){e.data(document,"select2-lastpos",{x:t.pageX,y:t.pageY})}),e(document).ready(function(){e(document).delegate("body","mousedown touchend",function(n){var r=e(n.target).closest("div.select2-container").get(0),i;r?e(document).find("div.select2-container-active").each(function(){this!==r&&e(this).data("select2").blur()}):(r=e(n.target).closest("div.select2-drop").get(0),e(document).find("div.select2-drop-active").each(function(){this!==r&&e(this).data("select2").blur()})),r=e(n.target),i=r.attr("for"),"LABEL"===n.target.tagName&&i&&i.length>0&&(r=e("#"+i),r=r.data("select2"),r!==t&&(r.focus(),n.preventDefault()))})}),r=k(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var r,i,s=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&n.element.data("select2")!==null&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+o()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=v(function(){return n.element.closest("body")}),n.element.attr("class")!==t&&this.container.addClass(n.element.attr("class").replace(/validate\[[\S ]+] ?/,"")),this.container.css(T(n.containerCss)),this.container.addClass(T(n.containerCssClass)),this.opts.element.data("select2",this).hide().before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(T(n.dropdownCssClass)),this.dropdown.data("select2",this),this.results=r=this.container.find(s),this.search=i=this.container.find("input.select2-input"),i.attr("tabIndex",this.opts.element.attr("tabIndex")),this.resultsPage=0,this.context=null,this.initContainer(),this.initContainerWidth(),p(this.results),this.dropdown.delegate(s,"mousemove-filtered",this.bind(this.highlightUnderEvent)),m(80,this.results),this.dropdown.delegate(s,"scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&r.mousewheel(function(e,t,n,i){var s=r.scrollTop(),o;i>0&&s-i<=0?(r.scrollTop(0),g(e)):i<0&&r.get(0).scrollHeight-r.scrollTop()+i<=r.height()&&(r.scrollTop(r.get(0).scrollHeight-r.height()),g(e))}),h(i),i.bind("keyup-change",this.bind(this.updateResults)),i.bind("focus",function(){i.addClass("select2-focused"),i.val()===" "&&i.val("")}),i.bind("blur",function(){i.removeClass("select2-focused")}),this.dropdown.delegate(s,"mouseup",this.bind(function(t){e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0?(this.highlightUnderEvent(t),this.selectHighlighted(t)):this.focusSearch(),g(t)})),this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),(n.element.is(":disabled")||n.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(n){var r,i,s,o;r=n.element,r.get(0).tagName.toLowerCase()==="select"&&(this.select=i=n.element),i&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(r,i,s){var o,u,a,f,l=this.opts.id,c=this;o=function(r,i,u){var a,f,h,p,d,v,m,g,y;for(a=0,f=r.length;a<f;a+=1)h=r[a],p=l(h)!==t,d=h.children&&h.children.length>0,v=e("<li></li>"),v.addClass("select2-results-dept-"+u),v.addClass("select2-result"),v.addClass(p?"select2-result-selectable":"select2-result-unselectable"),d&&v.addClass("select2-result-with-children"),v.addClass(c.opts.formatResultCssClass(h)),m=e("<div></div>"),m.addClass("select2-result-label"),y=n.formatResult(h,m,s),y!==t&&m.html(c.opts.escapeMarkup(y)),v.append(m),d&&(g=e("<ul></ul>"),g.addClass("select2-result-sub"),o(h.children,g,u+1),v.append(g)),v.data("select2-data",h),i.append(v)},o(i,r,0)}},e.fn.select2.defaults,n),typeof n.id!="function"&&(s=n.id,n.id=function(e){return e[s]}),i?(n.query=this.bind(function(n){var i={results:[],more:!1},s=n.term,o,u,a;a=function(e,t){var r;e.is("option")?n.matcher(s,e.text(),e)&&t.push({id:e.attr("value"),text:e.text(),element:e.get(),css:e.attr("class")}):e.is("optgroup")&&(r={text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")},e.children().each2(function(e,t){a(t,r.children)}),r.children.length>0&&t.push(r))},o=r.children(),this.getPlaceholder()!==t&&o.length>0&&(u=o[0],e(u).text()===""&&(o=o.not(u))),o.each2(function(e,t){a(t,i.results)}),n.callback(i)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(o=n.element.data("ajax-url"),o&&o.length>0&&(n.ajax.url=o),n.query=w(n.ajax)):"data"in n?n.query=E(n.data):"tags"in n&&(n.query=S(n.tags),n.createSearchChoice=function(e){return{id:e,text:e}},n.initSelection=function(t,r){var i=[];e(l(t.val(),n.separator)).each(function(){var t=this,r=this,s=n.tags;e.isFunction(s)&&(s=s()),e(s).each(function(){if(f(this.id,t))return r=this.text,!1}),i.push({id:t,text:r})}),r(i)}));if(typeof n.query!="function")throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){if(this.enabled)return;this.enabled=!0,this.container.removeClass("select2-container-disabled")},disable:function(){if(!this.enabled)return;this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t=this.container.offset(),n=this.container.outerHeight(),r=this.container.outerWidth(),i=this.dropdown.outerHeight(),s=e(window).scrollTop()+document.documentElement.clientHeight,o=t.top+n,u=t.left,a=o+i<=s,f=t.top-i>=this.body().scrollTop(),l=this.dropdown.hasClass("select2-drop-above"),c,h,p;this.body().css("position")!=="static"&&(c=this.body().offset(),o-=c.top,u-=c.left),l?(h=!0,!f&&a&&(h=!1)):(h=!1,!a&&f&&(h=!0)),h?(o=t.top-i,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),p=e.extend({top:o,left:u,width:r},T(this.opts.dropdownCss)),this.dropdown.css(p)},shouldOpen:function(){var t;return this.opened()?!1:(t=e.Event("open"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(window.setTimeout(this.bind(this.opening),1),!0):!1},opening:function(){var t=this.containerId,n=this.containerSelector,r="scroll."+t,i="resize."+t;this.container.parents().each(function(){e(this).bind(r,function(){var t=e(n);t.length==0&&e(this).unbind(r),t.select2("close")})}),e(window).bind(i,function(){var t=e(n);t.length==0&&e(window).unbind(i),t.select2("close")}),this.clearDropdownAlignmentPreference(),this.search.val()===" "&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible(),this.focusSearch()},close:function(){if(!this.opened())return;var t=this;this.container.parents().each(function(){e(this).unbind("scroll."+t.containerId)}),e(window).unbind("resize."+this.containerId),this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.opts.element.trigger(e.Event("close"))},clearSearch:function(){},ensureHighlightVisible:function(){var t=this.results,n,r,i,s,o,u,a;r=this.highlight();if(r<0)return;if(r==0){t.scrollTop(0);return}n=t.find(".select2-result-selectable"),i=e(n[r]),s=i.offset().top+i.outerHeight(),r===n.length-1&&(a=t.find("li.select2-more-results"),a.length>0&&(s=a.offset().top+a.outerHeight())),o=t.offset().top+t.outerHeight(),s>o&&t.scrollTop(t.scrollTop()+(s-o)),u=i.offset().top-t.offset().top,u<0&&t.scrollTop(t.scrollTop()+u)},moveHighlight:function(t){var n=this.results.find(".select2-result-selectable"),r=this.highlight();while(r>-1&&r<n.length){r+=t;var i=e(n[r]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")){this.highlight(r);break}}},highlight:function(t){var n=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0)return a(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1),t<0&&(t=0),n.removeClass("select2-highlighted"),e(n[t]).addClass("select2-highlighted"),this.ensureHighlightVisible()},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var r=this.results.find(".select2-result-selectable");this.highlight(r.index(n))}else n.length==0&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),n,r=-1,i=this.resultsPage+1,s=this,o=this.search.val(),u=this.context;if(t.length===0)return;n=t.offset().top-e.offset().top-e.height(),n<=0&&(t.addClass("select2-active"),this.opts.query({term:o,page:i,context:u,matcher:this.opts.matcher,callback:this.bind(function(n){if(!s.opened())return;s.opts.populateResults.call(this,e,n.results,{term:o,page:i,context:u}),n.more===!0?(t.detach().appendTo(e).text(s.opts.formatLoadMore(i+1)),window.setTimeout(function(){s.loadMoreIfNeeded()},10)):t.remove(),s.positionDropdown(),s.resultsPage=i})}))},tokenize:function(){},updateResults:function(n){function l(){i.scrollTop(0),r.removeClass("select2-active"),u.positionDropdown()}function c(e){i.html(u.opts.escapeMarkup(e)),l()}var r=this.search,i=this.results,s=this.opts,o,u=this,a;if(n!==!0&&(this.showSearchInput===!1||!this.opened()))return;r.addClass("select2-active");if(s.maximumSelectionSize>=1){o=this.data();if(e.isArray(o)&&o.length>=s.maximumSelectionSize&&x(s.formatSelectionTooBig,"formatSelectionTooBig")){c("<li class='select2-selection-limit'>"+s.formatSelectionTooBig(s.maximumSelectionSize)+"</li>");return}}if(r.val().length<s.minimumInputLength&&x(s.formatInputTooShort,"formatInputTooShort")){c("<li class='select2-no-results'>"+s.formatInputTooShort(r.val(),s.minimumInputLength)+"</li>");return}c("<li class='select2-searching'>"+s.formatSearching()+"</li>"),a=this.tokenize(),a!=t&&a!=null&&r.val(a),this.resultsPage=1,s.query({term:r.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(o){var a;if(!this.opened())return;this.context=o.context===t?null:o.context,this.opts.createSearchChoice&&r.val()!==""&&(a=this.opts.createSearchChoice.call(null,r.val(),o.results),a!==t&&a!==null&&u.id(a)!==t&&u.id(a)!==null&&e(o.results).filter(function(){return f(u.id(this),u.id(a))}).length===0&&o.results.unshift(a));if(o.results.length===0&&x(s.formatNoMatches,"formatNoMatches")){c("<li class='select2-no-results'>"+s.formatNoMatches(r.val())+"</li>");return}i.empty(),u.opts.populateResults.call(this,i,o.results,{term:r.val(),page:this.resultsPage,context:null}),o.more===!0&&x(s.formatLoadMore,"formatLoadMore")&&(i.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(s.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(o,n),l()})})},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){this.search.show(),this.search.focus(),window.setTimeout(this.bind(function(){this.search.show(),this.search.focus(),this.search.val(this.search.val())}),10)},selectHighlighted:function(){var e=this.highlight(),t=this.results.find(".select2-highlighted").not(".select2-disabled"),n=t.closest(".select2-result-selectable").data("select2-data");n&&(t.addClass("select2-disabled"),this.highlight(e),this.onSelect(n))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function n(){var n,r,i,s,o;if(this.opts.width==="off")return null;if(this.opts.width==="element")return this.opts.element.outerWidth()===0?"auto":this.opts.element.outerWidth()+"px";if(this.opts.width==="copy"||this.opts.width==="resolve"){n=this.opts.element.attr("style");if(n!==t){r=n.split(";");for(s=0,o=r.length;s<o;s+=1){i=r[s].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(i!==null&&i.length>=1)return i[1]}}return this.opts.width==="resolve"?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:this.opts.element.outerWidth()===0?"auto":this.opts.element.outerWidth()+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var r=n.call(this);r!==null&&this.container.attr("style","width: "+r)}}),i=k(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container"}).html(["    <a href='#' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},opening:function(){this.search.show(),this.parent.opening.apply(this,arguments),this.dropdown.removeClass("select2-offscreen")},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments),this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show()},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var e,t=this.container,r=this.dropdown,i=!1;this.selection=e=t.find(".select2-choice"),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){g(e);return}if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),g(e);return;case n.TAB:case n.ENTER:this.selectHighlighted(),g(e);return;case n.ESC:this.cancel(e),g(e);return}else{if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open();if(e.which===n.ENTER)return}})),this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")})),this.search.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("mousedown",this.bind(function(e){i=!0,this.opened()?(this.close(),this.selection.focus()):this.enabled&&this.open(),i=!1})),r.bind("mousedown",this.bind(function(){this.search.focus()})),e.bind("focus",this.bind(function(){this.container.addClass("select2-container-active"),this.search.attr("tabIndex","-1")})),e.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){g(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;if(e.which==n.DELETE){this.opts.allowClear&&this.clear();return}this.open();if(e.which===n.ENTER){g(e);return}if(e.which<48){g(e);return}var t=String.fromCharCode(e.which).toLowerCase();e.shiftKey&&(t=t.toUpperCase()),this.search.focus(),this.search.val(t),g(e)})),e.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear(),g(e),this.close(),this.triggerChange(),this.selection.focus()})),this.setPlaceholder(),this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){var e;if(this.opts.element.val()==="")this.close(),this.setPlaceholder();else{var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=t.find(":selected");e.isFunction(n)&&n({id:r.attr("value"),text:r.text()})}),t},setPlaceholder:function(){var e=this.getPlaceholder();if(this.opts.element.val()===""&&e!==t){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.selection.find("abbr").hide()}},postprocessResults:function(t,n){var r=0,i=this,s=!0;this.results.find(".select2-result-selectable").each2(function(e,t){if(f(i.id(t.data("select2-data")),i.opts.element.val()))return r=e,!1}),this.highlight(r),n===!0&&(s=this.showSearchInput=N(t.results)>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[s?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[s?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),f(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var n=this.selection.find("span"),r;this.selection.data("select2-data",e),n.empty(),r=this.opts.formatSelection(e,n),r!==t&&n.append(this.opts.escapeMarkup(r)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,n=null,r=this;if(arguments.length===0)return this.opts.element.val();e=arguments[0];if(this.select)this.select.val(e).find(":selected").each2(function(e,t){return n={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(n),this.setPlaceholder();else{if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");if(!e){this.clear();return}this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){r.opts.element.val(e?r.id(e):""),r.updateSelection(e),r.setPlaceholder()})}},clearSearch:function(){this.search.val("")},data:function(e){var n;if(arguments.length===0)return n=this.selection.data("select2-data"),n==t&&(n=null),n;!e||e===""?this.clear():(this.opts.element.val(e?this.id(e):""),this.updateSelection(e))}}),s=k(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=[];t.find(":selected").each2(function(e,t){r.push({id:t.attr("value"),text:t.text()})}),e.isFunction(n)&&n(r)}),t},initContainer:function(){var t=".select2-choices",r;this.searchContainer=this.container.find(".select2-search-field"),this.selection=r=this.container.find(t),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.BACKSPACE&&this.search.val()===""){this.close();var t,i=r.find(".select2-search-choice-focus");if(i.length>0){this.unselect(i.first()),this.search.width(10),g(e);return}t=r.find(".select2-search-choice"),t.length>0&&t.last().addClass("select2-search-choice-focus")}else r.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),g(e);return;case n.ENTER:case n.TAB:this.selectHighlighted(),g(e);return;case n.ESC:this.cancel(e),g(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.BACKSPACE||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open(),(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN)&&g(e)})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.clearSearch(),e.stopImmediatePropagation()})),this.container.delegate(t,"mousedown",this.bind(function(t){if(!this.enabled)return;if(e(t.target).closest(".select2-search-choice").length>0)return;this.clearPlaceholder(),this.open(),this.focusSearch(),t.preventDefault()})),this.container.delegate(t,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder()})),this.clearSearch()},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments),this.search.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments),this.search.attr("disabled",!0)},initSelection:function(){var e;this.opts.element.val()===""&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||this.opts.element.val()!==""){var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&this.getVal().length===0&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.resizeSearch()):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):this.search.val()===" "&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments),this.clearPlaceholder(),this.resizeSearch(),this.focusSearch()},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],i=this;e(t).each(function(){a(i.id(this),n)<0&&(n.push(i.id(this)),r.push(this))}),t=r,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){i.addSelectedChoice(this)}),i.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts),e!=null&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e){this.addSelectedChoice(e),this.select&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.positionDropdown()):this.close(),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(t){var n=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),r=this.id(t),i=this.getVal(),s;s=this.opts.formatSelection(t,n),n.find("div").replaceWith("<div>"+this.opts.escapeMarkup(s)+"</div>"),n.find(".select2-search-choice-close").bind("mousedown",g).bind("click dblclick",this.bind(function(t){if(!this.enabled)return;e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),g(t)})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active")})),n.data("select2-data",t),n.insertBefore(this.searchContainer),i.push(r),this.setVal(i)},unselect:function(e){var t=this.getVal(),n,r;e=e.closest(".select2-search-choice");if(e.length===0)throw"Invalid argument: "+e+". Must be .select2-search-choice";n=e.data("select2-data"),r=a(this.id(n),t),r>=0&&(t.splice(r,1),this.setVal(t),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:n})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),n=this.results.find(".select2-result-with-children"),r=this;t.each2(function(t,n){var i=r.id(n.data("select2-data"));a(i,e)>=0?n.addClass("select2-disabled").removeClass("select2-result-selectable"):n.removeClass("select2-disabled").addClass("select2-result-selectable")}),n.each2(function(e,t){t.find(".select2-result-selectable").length==0?t.addClass("select2-disabled"):t.removeClass("select2-disabled")}),t.each2(function(e,t){if(!t.hasClass("select2-disabled")&&t.hasClass("select2-result-selectable"))return r.highlight(0),!1})},resizeSearch:function(){var e,t,n,r,i,s=c(this.search);e=y(this.search)+10,t=this.search.offset().left,n=this.selection.width(),r=this.selection.offset().left,i=n-(t-r)-s,i<e&&(i=n-s),i<40&&(i=n-s),this.search.width(i)},getVal:function(){var e;return this.select?(e=this.select.val(),e===null?[]:e):(e=this.opts.element.val(),l(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){a(this,n)<0&&n.push(this)}),this.opts.element.val(n.length===0?"":n.join(this.opts.separator)))},val:function(){var n,r=[],i=this;if(arguments.length===0)return this.getVal();n=arguments[0];if(!n){this.opts.element.val(""),this.updateSelection([]),this.clearSearch();return}this.setVal(n);if(this.select)this.select.find(":selected").each(function(){r.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(r);else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e(t).map(i.id);i.setVal(n),i.updateSelection(t),i.clearSearch()})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t){var n=this,r;if(arguments.length===0)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();t||(t=[]),r=e.map(t,function(e){return n.opts.id(e)}),this.setVal(r),this.updateSelection(t),this.clearSearch()}}),e.fn.select2=function(){var n=Array.prototype.slice.call(arguments,0),r,o,u,f,l=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];return this.each(function(){if(n.length===0||typeof n[0]=="object")r=n.length===0?{}:e.extend({},n[0]),r.element=e(this),r.element.get(0).tagName.toLowerCase()==="select"?f=r.element.attr("multiple"):(f=r.multiple||!1,"tags"in r&&(r.multiple=f=!0)),o=f?new s:new i,o.init(r);else{if(typeof n[0]!="string")throw"Invalid arguments to select2 plugin: "+n;if(a(n[0],l)<0)throw"Unknown method: "+n[0];u=t,o=e(this).data("select2");if(o===t)return;n[0]==="container"?u=o.container:u=o[n[0]].apply(o,n.slice(1));if(u!==t)return!1}}),u===t?this:u},e.fn.select2.defaults={width:"copy",closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n){var r=[];return b(e.text,n.term,r),r.join("")},formatSelection:function(e,n){return e?e.text:t},formatResultCssClass:function(e){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(e==1?"":"s")},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:C,escapeMarkup:function(e){return e&&typeof e=="string"?e.replace(/&/g,"&amp;"):e},blurOnChange:!1},window.Select2={query:{ajax:w,local:E,tags:S},util:{debounce:d,markMatch:b},"class":{"abstract":r,single:i,multi:s}}}(e),!0}),define("instance-admin/utils/select2-helpers",["jquery","underscore","jquery.select2"],function(e,t){var n={};return n.create_arguments_for_model=function(n){var r=(new n.model).urlRoot;return{placeholder:n.placeholder,allowClear:!0,ajax:{url:r,data:function(e,t){return{name:e}},results:function(e,n){var r=t.map(e,function(e){return{id:e._id,text:e.name}});return{results:r}}},createSearchChoice:function(e){return{id:0,text:e}},initSelection:function(e,t){var r=e.val();if(!r)return t(null);var i=new n.model({id:r});i.fetch({success:function(e,n){t({id:n._id,text:n.name})},error:function(e,r){n.errors_list.append("<li>Could not fetch model from server</li>"),t(null)}})},formatSelection:function(e,t){var n=e.text;return e.id||(n+=" <em>(new entry)</em>"),n},formatResult:function(t,n){var r=e("<span>").text(t.text);return r.append(t.id?"<em> &larr; select to use existing entry</em>":"<em> &larr; select to create new entry</em>"),r}}},n.create_arguments_for_autocompleter=function(e){return{placeholder:e.placeholder,ajax:{url:e.autocomplete_url,data:function(e,t){return{term:e}},results:function(e,n){return{results:t.map(e,function(e){return{id:e,text:e}})}}},createSearchChoice:function(e){return{id:e,text:e}}}},n.create_arguments_for_partial_date=function(e){var n=e.initial_date||{};return{placeholder:"no date",allowClear:!0,initSelection:function(e,t){t({id:n.formatted,text:n.formatted,raw:n})},ajax:{url:"/autocomplete/partial_date",data:function(e,t){return e||(e=n.formatted),{term:e}},results:function(e){var n=t.map(e,function(e){return{id:e.formatted,text:e.formatted,raw:e}});return{results:n}}},width:"100%"}},n.create_model_if_needed_for_data=function(e,t){return function(n){t===null?n.resolve(null):t.id?n.resolve(t.id):(new e({name:t.text})).save({},{success:function(e,t){n.resolve(t._id)},error:function(e,t){n.reject(t)}})}},n}),define("instance-admin/views/position-new",["jquery","Backbone","backbone-forms","underscore","templates","instance-admin/models/person","instance-admin/models/organisation","instance-admin/models/position","instance-admin/views/submit-form-helper","instance-admin/views/suggestions","instance-admin/utils/select2-helpers"],function(e,t,n,r,i,s,o,u,a,f,l){var c=t.View.extend({render:function(){var t=e(i.render("position/new.html",{}));return this.$title_input=t.find("[name=title]"),this.$person_input=t.find("[name=person]"),this.$organisation_input=t.find("[name=organisation]"),this.$start_date_input=t.find("[name=start-date]"),this.$end_date_input=t.find("[name=end-date]"),this.$errors_list=t.find("ul.error"),this.$title_input.val(this.model.get("title")),this.$person_input.val(this.model.get("person")),this.$organisation_input.val(this.model.get("organisation")),this.$title_input.select2(l.create_arguments_for_autocompleter({placeholder:"e.g President, CEO, Professor, Coach",autocomplete_url:"/autocomplete/position_title"})),this.$person_input.select2(l.create_arguments_for_model({placeholder:"e.g Joe Bloggs, Jane Smith",model:s,errors_list:this.$errors_list})),this.$organisation_input.select2(l.create_arguments_for_model({placeholder:"e.g Apple Inc, UK Parliament, Kenyatta University",model:o,errors_list:this.$errors_list})),this.$start_date_input.select2(l.create_arguments_for_partial_date({})),this.$end_date_input.select2(l.create_arguments_for_partial_date({})),this.options.fields_to_hide.title&&t.find("p.title").hide(),this.options.fields_to_hide.person&&t.find("p.person").hide(),this.options.fields_to_hide.organisation&&t.find("p.organisation").hide(),this.$el.html(t),this},events:{"submit form":"submitForm"},submitForm:function(t){t.preventDefault();var n=this;n.$errors_list.html("");var r=n.$title_input.select2("data"),i=r?r.text:!1;if(!i){n.$errors_list.append("<li>Title is required</li>");return}e.when(e.Deferred(l.create_model_if_needed_for_data(s,n.$person_input.select2("data"))),e.Deferred(l.create_model_if_needed_for_data(o,n.$organisation_input.select2("data")))).then(function(e,t){var r=n.$start_date_input.select2("data")||{},s=n.$end_date_input.select2("data")||{},o=new u({person:e,organisation:t,title:i,start_date:r.raw||{},end_date:s.raw||{}});o.save({},{success:function(e,t){document.location=t.meta.edit_url},error:function(e,t){n.$errors_list.append("<li>Something went wrong saving the position to the server.</li>")}})})}});return c}),define("instance-admin/actions/position-add-remove",["jquery","instance-admin/app","instance-admin/models/position","instance-admin/views/position-new","jquery.fancybox"],function(e,t,n,r,i){t.addInitializer(function(t){e("a.new-position").click(function(t){var i=e(this);t.preventDefault();var s=new n({person:i.attr("data-person-id"),organisation:i.attr("data-organisation-id"),title:i.attr("data-title")}),o={person:i.attr("data-person-hide-field")?!0:!1,organisation:i.attr("data-organisation-hide-field")?!0:!1,title:i.attr("data-title-hide-field")?!0:!1},u=new r({model:s,fields_to_hide:o});e.fancybox(u.render().el)})})}),define("jqueryui/core",["jquery"],function(e){(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;return!t.href||!o||s.nodeName.toLowerCase()!=="map"?!1:(u=e("img[usemap=#"+o+"]")[0],!!u&&r(u))}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"@VERSION",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),s&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.curCSS||(e.curCSS=e.css),e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r)i.plugins[s]=i.plugins[s]||[],i.plugins[s].push([n,r[s]])},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(e)}),define("jqueryui/widget",["jquery"],function(e){(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}})(e)}),define("jqueryui/position",["jquery"],function(e){(function(e,t){e.ui=e.ui||{};var n=/left|center|right/,r=/top|center|bottom/,i="center",s={},o=e.fn.position,u=e.fn.offset;e.fn.position=function(t){if(!t||!t.of)return o.apply(this,arguments);t=e.extend({},t);var u=e(t.of),a=u[0],f=(t.collision||"flip").split(" "),l=t.offset?t.offset.split(" "):[0,0],c,h,p;return a.nodeType===9?(c=u.width(),h=u.height(),p={top:0,left:0}):a.setTimeout?(c=u.width(),h=u.height(),p={top:u.scrollTop(),left:u.scrollLeft()}):a.preventDefault?(t.at="left top",c=h=0,p={top:t.of.pageY,left:t.of.pageX}):(c=u.outerWidth(),h=u.outerHeight(),p=u.offset()),e.each(["my","at"],function(){var e=(t[this]||"").split(" ");e.length===1&&(e=n.test(e[0])?e.concat([i]):r.test(e[0])?[i].concat(e):[i,i]),e[0]=n.test(e[0])?e[0]:i,e[1]=r.test(e[1])?e[1]:i,t[this]=e}),f.length===1&&(f[1]=f[0]),l[0]=parseInt(l[0],10)||0,l.length===1&&(l[1]=l[0]),l[1]=parseInt(l[1],10)||0,t.at[0]==="right"?p.left+=c:t.at[0]===i&&(p.left+=c/2),t.at[1]==="bottom"?p.top+=h:t.at[1]===i&&(p.top+=h/2),p.left+=l[0],p.top+=l[1],this.each(function(){var n=e(this),r=n.outerWidth(),o=n.outerHeight(),u=parseInt(e.curCSS(this,"marginLeft",!0))||0,a=parseInt(e.curCSS(this,"marginTop",!0))||0,d=r+u+(parseInt(e.curCSS(this,"marginRight",!0))||0),v=o+a+(parseInt(e.curCSS(this,"marginBottom",!0))||0),m=e.extend({},p),g;t.my[0]==="right"?m.left-=r:t.my[0]===i&&(m.left-=r/2),t.my[1]==="bottom"?m.top-=o:t.my[1]===i&&(m.top-=o/2),s.fractions||(m.left=Math.round(m.left),m.top=Math.round(m.top)),g={left:m.left-u,top:m.top-a},e.each(["left","top"],function(n,i){e.ui.position[f[n]]&&e.ui.position[f[n]][i](m,{targetWidth:c,targetHeight:h,elemWidth:r,elemHeight:o,collisionPosition:g,collisionWidth:d,collisionHeight:v,offset:l,my:t.my,at:t.at})}),e.fn.bgiframe&&n.bgiframe(),n.offset(e.extend(m,{using:t.using}))})},e.ui.position={fit:{left:function(t,n){var r=e(window),i=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();t.left=i>0?t.left-i:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window),i=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();t.top=i>0?t.top-i:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]===i)return;var r=e(window),s=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft(),o=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,u=n.at[0]==="left"?n.targetWidth:-n.targetWidth,a=-2*n.offset[0];t.left+=n.collisionPosition.left<0?o+u+a:s>0?o+u+a:0},top:function(t,n){if(n.at[1]===i)return;var r=e(window),s=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop(),o=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,u=n.at[1]==="top"?n.targetHeight:-n.targetHeight,a=-2*n.offset[1];t.top+=n.collisionPosition.top<0?o+u+a:s>0?o+u+a:0}}},e.offset.setOffset||(e.offset.setOffset=function(t,n){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",!0),10)||0,o=parseInt(e.curCSS(t,"left",!0),10)||0,u={top:n.top-i.top+s,left:n.left-i.left+o};"using"in n?n.using.call(t,u):r.css(u)},e.fn.offset=function(t){var n=this[0];return!n||!n.ownerDocument?null:t?e.isFunction(t)?this.each(function(n){e(this).offset(t.call(this,n,e(this).offset()))}):this.each(function(){e.offset.setOffset(this,t)}):u.call(this)}),function(){var t=document.getElementsByTagName("body")[0],n=document.createElement("div"),r,i,o,u,a;r=document.createElement(t?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},t&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"});for(var f in o)r.style[f]=o[f];r.appendChild(n),i=t||document.documentElement,i.insertBefore(r,i.firstChild),n.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",u=e(n).offset(function(e,t){return t}).offset(),r.innerHTML="",i.removeChild(r),a=u.top+u.left+(t?2e3:0),s.fractions=a>21&&a<22}()})(e)}),define("jqueryui/autocomplete",["jquery","./core","./widget","./position"],function(e){(function(e,t){var n=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(t.options.disabled||t.element.propAttr("readOnly"))return;r=!1;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._keyEvent("previous",n);break;case i.DOWN:t._keyEvent("next",n);break;case i.ENTER:case i.NUMPAD_ENTER:t.menu.active&&(r=!0,n.preventDefault());case i.TAB:if(!t.menu.active)return;t.menu.select(n);break;case i.ESCAPE:t.element.val(t.term),t.close(n);break;default:clearTimeout(t.searching),t.searching=setTimeout(function(){t.term!=t.element.val()&&(t.selectedItem=null,t.search(null,n))},t.options.delay)}}).bind("keypress.autocomplete",function(e){r&&(r=!1,e.preventDefault())}).bind("focus.autocomplete",function(){if(t.options.disabled)return;t.selectedItem=null,t.previous=t.element.val()}).bind("blur.autocomplete",function(e){if(t.options.disabled)return;clearTimeout(t.searching),t.closing=setTimeout(function(){t.close(e),t._change(e)},150)}),this._initSource(),this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.ui.contains(r,n.target)&&t.close()})},1),setTimeout(function(){clearTimeout(t.closing)},13)}).menu({focus:function(e,n){var r=n.item.data("item.autocomplete");!1!==t._trigger("focus",e,{item:r})&&/^key/.test(e.originalEvent.type)&&t.element.val(r.value)},selected:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;t.element[0]!==n.activeElement&&(t.element.focus(),t.previous=s,setTimeout(function(){t.previous=s,t.selectedItem=i},1)),!1!==t._trigger("select",e,{item:i})&&t.element.val(i.value),t.term=t.element.val(),t.close(e),t.selectedItem=i},blur:function(e,n){t.menu.element.is(":visible")&&t.element.val()!==t.term&&t.element.val(t.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe(),t.beforeunloadHandler=function(){t.element.removeAttr("autocomplete")},e(window).bind("beforeunload",t.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e(window).unbind("beforeunload",this.beforeunloadHandler),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t==="source"&&this._initSource(),t==="appendTo"&&this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]),t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var t=this,n,r;e.isArray(this.options.source)?(n=this.options.source,this.source=function(t,r){r(e.ui.autocomplete.filter(n,t.term))}):typeof this.options.source=="string"?(r=this.options.source,this.source=function(n,i){t.xhr&&t.xhr.abort(),t.xhr=e.ajax({url:r,data:n,dataType:"json",success:function(e,t){i(e)},error:function(){i([])}})}):this.source=this.options.source},search:function(e,t){e=e!=null?e:this.element.val(),this.term=this.element.val();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close()},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.deactivate(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this.element.val(this.term),this.menu.deactivate();return}this.menu[e](t)},widget:function(){return this.menu.element},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})})(e),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){if(!e(n.target).closest(".ui-menu-item a").length)return;n.preventDefault(),t.select(n)}),this.refresh()},refresh:function(){var t=this,n=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");n.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){t.activate(n,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){this.deactivate();if(this.hasScroll()){var n=t.offset().top-this.element.offset().top,r=this.element.scrollTop(),i=this.element.height();n<0?this.element.scrollTop(r+n):n>=i&&this.element.scrollTop(r+n-i+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,n){if(!this.active){this.activate(n,this.element.children(t));return}var r=this.active[e+"All"](".ui-menu-item").eq(0);r.length?this.activate(n,r):this.activate(n,this.element.children(t))},nextPage:function(t){if(this.hasScroll()){if(!this.active||this.last()){this.activate(t,this.element.children(".ui-menu-item:first"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n-r+e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:last")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll()){if(!this.active||this.first()){this.activate(t,this.element.children(".ui-menu-item:last"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n+r-e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:first")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(e)}),define("instance-admin/views/list-item-edit",["jquery","underscore","templates","Backbone","backbone-forms","instance-admin/views/submit-form-helper","jqueryui/autocomplete"],function(e,t,n,r,i,s){var o=r.View.extend({initialize:function(){this.model.on("change",this.render,this),this.form=new i({model:this.model})},render:function(){var n=this.model.schema,r=e(this.form.render().el);r.find("ul").append('<input type="submit" name="save" value="Save" />').append('<button name="delete">Delete</button>').append('<button name="cancel">Cancel</button>');var i=t.filter(t.keys(n),function(e){return n[e].autocomplete_source});return t.each(i,function(e){var t=n[e].autocomplete_source;r.find('input[name="'+e+'"]').autocomplete({source:t})}),this.$el.html(r),this},events:{"submit form ":"submitForm",'click button[name="cancel"]':"cancelEntry",'click button[name="delete"]':"deleteEntry"},deleteEntry:function(e){e.preventDefault(),this.model.destroy(),this.remove()},cancelEntry:function(e){e.preventDefault(),this.model.id?this.render_listing(this.model):this.remove()},render_listing:function(e){var t=this,r={item:e.toJSON(),api_url_root:e.urlRoot};t.$el.html(n.render(t.template,r))},submitForm:function(e){var t=this,n=s({pre_save_cb:function(){t.render_listing(t.model)},success_cb:function(e,n){t.render_listing(e)},view:t});n(e)}});return o}),define("instance-admin/actions/list-item-editor",["jquery","instance-admin/views/list-item-edit"],function(e,t){return function(n){var r=n.model;return function(i){var s=e(this),o=e(this).closest("li");i.preventDefault();var u=new r({}),a=s.attr("data-id");a&&(u.id=a),u.urlRoot=s.attr("data-url-root");var f=new t({model:u,el:o});f.template=n.template,u.isNew()?(o.after(o.clone()),f.render()):u.fetch()}}}),define("instance-admin/models/contact",["Backbone"],function(e){var t=e.Model.extend({idAttribute:"_id",schema:{kind:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/contact_kind"},value:{dataType:"Text",validators:["required"]}}});return t}),define("instance-admin/actions/contact-edit",["jquery","instance-admin/app","instance-admin/actions/list-item-editor","instance-admin/models/contact"],function(e,t,n,r){t.addInitializer(function(t){e("#content").on("click","a.contact-edit",new n({model:r,template:"contact/view.html"}))})}),define("instance-admin/models/link",["Backbone"],function(e){return e.Model.extend({idAttribute:"_id",schema:{url:{dataType:"Text",validators:["required"]},comment:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/link_comment"}}})}),define("instance-admin/actions/links-edit",["jquery","instance-admin/app","instance-admin/actions/list-item-editor","instance-admin/models/link"],function(e,t,n,r){t.addInitializer(function(t){e("#content").on("click","a.link-edit",new n({model:r,template:"link/view.html"}))})}),define("instance-admin/models/partial-date",["Backbone","underscore"],function(e,t){return e.Model.extend({toJSON:function(){var e=t.clone(this.attributes),n={},r=this.path_to_date;return t.each(e,function(e,t){n[r+"."+t]=e}),n},destroy:function(){throw new Error("destroy not permitted to prevent accidental data loss")}})}),define("instance-admin/views/partial-date-edit",["jquery","underscore","Backbone","templates","../models/person","instance-admin/utils/select2-helpers"],function(e,t,n,r,i,s){var o=function(e){var t=new Date(e),n=t.getFullYear().toString(),r=(t.getMonth()+1).toString(),i=t.getDate().toString();return n+"-"+(r[1]?r:"0"+r[0])+"-"+(i[1]?i:"0"+i[0])};return n.View.extend({render:function(){var t=this.model,n,r,i;t.get("start")&&(n=o(t.get("start")),r=o(t.get("end")),i=n,n!=r&&(i+=" to "+r));var u=e('<input type="text" name="'+t.path_to_date+'"/>');u.val(i);var a=e("<form />").append(u).append('<input type="submit" value="Save" />');return u.select2(s.create_arguments_for_partial_date({initial_date:{start:n,end:r,formatted:i}})),this.$el.html(a),this},events:{"submit form ":"submitForm"},submitForm:function(e){e.preventDefault();var t=this.$el.find('input[type="text"]').select2("data"),n=this,s=this.model;t=t||{raw:{start:"",end:""}},s.save({start:t.raw.start,end:t.raw.end},{success:function(e,t){var o=new i;o.id=s.id,o.fetch({success:function(e,t){var i=e.toJSON();i.api_base_url=e.urlRoot,i.id=e.id;var o=function(e,t){if(!e)return t;var n=e.split("."),r=n.shift(),i=n.join(".");return o(i,t[r])},u={person:i,date:o(s.link_data.pathPrefix,i),data_path_prefix:s.link_data.pathPrefix,data_url_root:s.link_data.urlRoot,data_id:s.link_data.id,title:s.link_data.title},a=r.render("partial-date/view.html",u),f=n.$el.clone().empty().html(a);n.$el.after(f),n.remove()},error:function(e,t){window.alert("Something went wrong fetching person to render template")}})},error:function(e,t){window.alert("Something went wrong saving the date")}})}})}),define("instance-admin/actions/partial-date-edit",["jquery","instance-admin/app","instance-admin/models/partial-date","instance-admin/views/partial-date-edit"],function(e,t,n,r){t.addInitializer(function(t){e("#content").on("click","a.partial-date-edit",function(t){t.preventDefault();var i=e(this),s=e(this).closest("li"),o=i.data(),u=new n({start:o.start,end:o.end});u.id=o.id,u.urlRoot=o.urlRoot,u.path_to_date=o.pathPrefix,u.link_data=o;var a=new r({model:u,el:s});a.render()})})}),function(){function e(e){var t=e.currentTarget||e.srcElement,n;if(e.type==="load"||s.test(t.readyState)){e=t.getAttribute("data-requiremodule"),u[e]=!0;for(e=0;n=o[e];e++){if(!u[n.name])break;n.req([n.name],n.onLoad)}e>0&&o.splice(0,e),setTimeout(function(){t.parentNode.removeChild(t)},15)}}function t(e){var t,n;e.setAttribute("data-orderloaded","loaded");for(e=0;n=f[e];e++){if(!(t=a[n])||t.getAttribute("data-orderloaded")!=="loaded")break;delete a[n],require.addScriptToDom(t)}e>0&&f.splice(0,e)}var n=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),r=n&&(n.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),i=n&&n.readyState==="uninitialized",s=/^(complete|loaded)$/,o=[],u={},a={},f=[],n=null;define("order",{version:"1.0.5",load:function(n,s,u,l){var c;s.nameToUrl?(c=s.nameToUrl(n,null),require.s.skipAsync[c]=!0,r||l.isBuild?s([n],u):i?(l=require.s.contexts._,!l.urlFetched[c]&&!l.loaded[n]&&(l.urlFetched[c]=!0,require.resourcesReady(!1),l.scriptCount+=1,c=require.attach(c,l,n,null,null,t),a[n]=c,f.push(n)),s([n],u)):s.specified(n)?s([n],u):(o.push({name:n,req:s,onLoad:u}),require.attach(c,null,n,e,"script/cache"))):s([n],u)}})}(),require(["augmenters/mailchecker","augmenters/migration","augmenters/slug-validation","augmenters/edit-in-place"]),require(["instance-admin/app","instance-admin/actions/person-add-remove","instance-admin/actions/organisation-add-remove","instance-admin/actions/position-add-remove","instance-admin/actions/contact-edit","instance-admin/actions/links-edit","instance-admin/actions/partial-date-edit"]),require(["order!jquery","instance-admin/app"],function(e,t){e.ajaxSetup({converters:{"text json":function(t){var n=e.parseJSON(t);return n?n.results||n.result||n:{}}}}),e(function(){t.start()})}),define("run-instance-admin",function(){}),require(["require-config","run-instance-admin"]),define("main-instance-admin",function(){});